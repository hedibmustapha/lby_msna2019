# Ready to summarize all our data
# PLEASE! Remember to source the data, questionnaire, choices, and weights from preliminary_weighted_analysis.R
source("code/data_merge_prep.R")

mantika_file <- dm_data %>%
  group_by(mantika_label) %>%
  summarize(age_hoh = weighted_median(age_hoh, ., group = !!get_group(.)),
            male_hoh = percent_response(sex_hoh, ., "male", group = !!get_group(.)),
            female_hoh = percent_response(sex_hoh, ., "female", group = !!get_group(.)),
            total_people = weighted_sum(size_hh, ., group = !!get_group(.)),
            size_hh = weighted_median(size_hh, ., group = !!get_group(.)),
            infants_female = round( 100 * (weighted_sum(nb_infants_female, ., group = !!get_group(.)) / total_people), 0),
            children_female = round( 100 * (weighted_sum(nb_children_female, ., group = !!get_group(.)) / total_people), 0),
            youth_female = round( 100 * (weighted_sum(nb_youth_female, ., group = !!get_group(.)) / total_people), 0),
            adults_female = round( 100 * (weighted_sum(nb_adults_female, ., group = !!get_group(.)) / total_people), 0),
            elderly_female = round( 100 * (weighted_sum(nb_elderly_female, ., group = !!get_group(.)) / total_people), 0),
            infants_male = round( 100 * (weighted_sum(nb_infants_male, ., group = !!get_group(.)) / total_people), 0),
            children_male = round( 100 * (weighted_sum(nb_children_male, ., group = !!get_group(.)) / total_people), 0),
            youth_male = round( 100 * (weighted_sum(nb_youth_male, ., group = !!get_group(.)) / total_people), 0),
            adults_male = round( 100 * (weighted_sum(nb_adults_male, ., group = !!get_group(.)) / total_people), 0),
            elderly_male = round( 100 * (weighted_sum(nb_elderly_male, ., group = !!get_group(.)) / total_people), 0),
            displ_2011 = percent_response(initially_displaced_year, ., "displaced_2011", group = !!get_group(.)),
            displ_2012 = percent_response(initially_displaced_year, ., "displaced_2012", group = !!get_group(.)),
            displ_2013 = percent_response(initially_displaced_year, ., "displaced_2013", group = !!get_group(.)),
            displ_2014 = percent_response(initially_displaced_year, ., "displaced_2014", group = !!get_group(.)),
            displ_2015 = percent_response(initially_displaced_year, ., "displaced_2015", group = !!get_group(.)),
            displ_2016 = percent_response(initially_displaced_year, ., "displaced_2016", group = !!get_group(.)),
            displ_2017 = percent_response(initially_displaced_year, ., "displaced_2017", group = !!get_group(.)),
            displ_2018 = percent_response(initially_displaced_year, ., "displaced_2018", group = !!get_group(.)),
            displ_2019 = percent_response(initially_displaced_year, ., "displaced_2019", group = !!get_group(.)),
            return_2011 = percent_response(returned_year, ., "displaced_2011", group = !!get_group(.)),
            return_2012 = percent_response(returned_year, ., "displaced_2012", group = !!get_group(.)),
            return_2013 = percent_response(returned_year, ., "displaced_2013", group = !!get_group(.)),
            return_2014 = percent_response(returned_year, ., "displaced_2014", group = !!get_group(.)),
            return_2015 = percent_response(returned_year, ., "displaced_2015", group = !!get_group(.)),
            return_2016 = percent_response(returned_year, ., "displaced_2016", group = !!get_group(.)),
            return_2017 = percent_response(returned_year, ., "displaced_2017", group = !!get_group(.)),
            return_2018 = percent_response(returned_year, ., "displaced_2018", group = !!get_group(.)),
            return_2019 = percent_response(returned_year, ., "displaced_2019", group = !!get_group(.)),
            displaced_once = num_percent_response(times_displaced_since_2011, ., 1, group = !!get_group(.)),
            displaced_twice = num_percent_response(times_displaced_since_2011, ., 2, group = !!get_group(.)),
            displaced_thrice = num_percent_response(times_displaced_since_2011, ., 3, group = !!get_group(.)),
            displaced_four_plus = num_percent_response(times_displaced_since_2011, ., 4:max(times_displaced_since_2011, na.rm = T), group = !!get_group(.)),
            push_factor_1_name = select_percents(push_factors, 1, ., questions, choices, "label", group = !!get_group(.)),
            push_factor_1_pct = select_percents(push_factors, 1, ., questions, choices, "percent", group = !!get_group(.)),
            push_factor_2_name = select_percents(push_factors, 2, ., questions, choices, "label", group = !!get_group(.)),
            push_factor_2_pct = select_percents(push_factors, 2, ., questions, choices, "percent", group = !!get_group(.)),
            push_factor_3_name = select_percents(push_factors, 3, ., questions, choices, "label", group = !!get_group(.)),
            push_factor_3_pct = select_percents(push_factors, 3, ., questions, choices, "percent", group = !!get_group(.)),
            no_return_1_name = select_percents(didnt_return_home_reasons, 1, ., questions, choices, "label", group = !!get_group(.)),
            no_return_1_pct = select_percents(didnt_return_home_reasons, 1, ., questions, choices, "percent", group = !!get_group(.)),
            no_return_2_name = select_percents(didnt_return_home_reasons, 2, ., questions, choices, "label", group = !!get_group(.)),
            no_return_2_pct = select_percents(didnt_return_home_reasons, 2, ., questions, choices, "percent", group = !!get_group(.)),
            no_return_3_name = select_percents(didnt_return_home_reasons, 3, ., questions, choices, "label", group = !!get_group(.)),
            no_return_3_pct = select_percents(didnt_return_home_reasons, 3, ., questions, choices, "percent", group = !!get_group(.)),
            returnee_incident_1_name = select_percents(returnee_issues, 1, ., questions, choices, "label", group = !!get_group(.)),
            returnee_incident_1_pct = select_percents(returnee_issues, 1, ., questions, choices, "percent", group = !!get_group(.)),
            returnee_incident_2_name = select_percents(returnee_issues, 2, ., questions, choices, "label", group = !!get_group(.)),
            returnee_incident_2_pct = select_percents(returnee_issues, 2, ., questions, choices, "percent", group = !!get_group(.)),
            returnee_incident_3_name = select_percents(returnee_issues, 3, ., questions, choices, "label", group = !!get_group(.)),
            returnee_incident_3_pct = select_percents(returnee_issues, 3, ., questions, choices, "percent", group = !!get_group(.)),
            returnee_fcs_poor = percent_response(filter(., displacement_status == "returnee")[["fcs_category"]],
                                                 filter(., displacement_status == "returnee"),
                                                 "poor",
                                                 x_name = "fcs_category", group = !!get_group(.)),
            returnee_fcs_borderline = percent_response(filter(., displacement_status == "returnee")[["fcs_category"]],
                                                       filter(., displacement_status == "returnee"),
                                                       "borderline",
                                                       x_name = "fcs_category", group = !!get_group(.)),
            returnee_fcs_acceptable = percent_response(filter(., displacement_status == "returnee")[["fcs_category"]],
                                                       filter(., displacement_status == "returnee"),
                                                       "acceptable",
                                                       x_name = "fcs_category", group = !!get_group(.)),
            idp_fcs_poor = percent_response(filter(., displacement_status == "idp")[["fcs_category"]],
                                            filter(., displacement_status == "idp"),
                                            "poor",
                                            x_name = "fcs_category", group = !!get_group(.)),
            idp_fcs_borderline = percent_response(filter(., displacement_status == "idp")[["fcs_category"]],
                                                  filter(., displacement_status == "idp"),
                                                  "borderline",
                                                  x_name = "fcs_category", group = !!get_group(.)),
            idp_fcs_acceptable = percent_response(filter(., displacement_status == "idp")[["fcs_category"]],
                                                  filter(., displacement_status == "idp"),
                                                  "acceptable",
                                                  x_name = "fcs_category", group = !!get_group(.)),
            non_displaced_fcs_poor = percent_response(filter(., displacement_status == "non_displaced")[["fcs_category"]],
                                                      filter(., displacement_status == "non_displaced"),
                                                      "poor",
                                                      x_name = "fcs_category", group = !!get_group(.)),
            non_displaced_fcs_borderline = percent_response(filter(., displacement_status == "non_displaced")[["fcs_category"]],
                                                            filter(., displacement_status == "non_displaced"),
                                                            "borderline",
                                                            x_name = "fcs_category", group = !!get_group(.)),
            non_displaced_fcs_acceptable = percent_response(filter(., displacement_status == "non_displaced")[["fcs_category"]],
                                                            filter(., displacement_status == "non_displaced"),
                                                            "acceptable",
                                                            x_name = "fcs_category", group = !!get_group(.)),
            returnee_rcsi_low = percent_response(filter(., displacement_status == "returnee")[["rcsi_category"]],
                                                 filter(., displacement_status == "returnee"),
                                                 "low",
                                                 x_name = "rcsi_category", group = !!get_group(.)),
            returnee_rcsi_medium = percent_response(filter(., displacement_status == "returnee")[["rcsi_category"]],
                                                    filter(., displacement_status == "returnee"),
                                                    "medium",
                                                    x_name = "rcsi_category", group = !!get_group(.)),
            returnee_rcsi_high = percent_response(filter(., displacement_status == "returnee")[["rcsi_category"]],
                                                  filter(., displacement_status == "returnee"),
                                                  "high",
                                                  x_name = "rcsi_category", group = !!get_group(.)),
            idp_rcsi_low = percent_response(filter(., displacement_status == "idp")[["rcsi_category"]],
                                            filter(., displacement_status == "idp"),
                                            "low",
                                            x_name = "rcsi_category", group = !!get_group(.)),
            idp_rcsi_medium = percent_response(filter(., displacement_status == "idp")[["rcsi_category"]],
                                               filter(., displacement_status == "idp"),
                                               "medium",
                                               x_name = "rcsi_category", group = !!get_group(.)),
            idp_rcsi_high = percent_response(filter(., displacement_status == "idp")[["rcsi_category"]],
                                             filter(., displacement_status == "idp"),
                                             "high",
                                             x_name = "rcsi_category", group = !!get_group(.)),
            non_displaced_rcsi_low = percent_response(filter(., displacement_status == "non_displaced")[["rcsi_category"]],
                                                      filter(., displacement_status == "non_displaced"),
                                                      "low",
                                                      x_name = "rcsi_category", group = !!get_group(.)),
            non_displaced_rcsi_medium = percent_response(filter(., displacement_status == "non_displaced")[["rcsi_category"]],
                                                         filter(., displacement_status == "non_displaced"),
                                                         "medium",
                                                         x_name = "rcsi_category", group = !!get_group(.)),
            non_displaced_rcsi_high = percent_response(filter(., displacement_status == "non_displaced")[["rcsi_category"]],
                                                       filter(., displacement_status == "non_displaced"),
                                                       "high",
                                                       x_name = "rcsi_category", group = !!get_group(.)),
            food_source_1_name = select_percents(food_source, 1, ., questions, choices, "label", group = !!get_group(.)),
            food_source_1_pct = select_percents(food_source, 1, ., questions, choices, "percent", group = !!get_group(.)),
            food_source_2_name = select_percents(food_source, 2, ., questions, choices, "label", group = !!get_group(.)),
            food_source_2_pct = select_percents(food_source, 2, ., questions, choices, "percent", group = !!get_group(.)),
            food_source_3_name = select_percents(food_source, 3, ., questions, choices, "label", group = !!get_group(.)),
            food_source_3_pct = select_percents(food_source, 3, ., questions, choices, "percent", group = !!get_group(.)),
            crop_production = percent_response(agricultural_production, ., "crop_production", group = !!get_group(.)),
            livestock_production = percent_response(agricultural_production, ., "livestock_production", group = !!get_group(.)),
            fishing_production = percent_response(agricultural_production, ., "fishing_production", group = !!get_group(.)),
            previous_activity = percent_response(agricultural_production_prior2011, ., "yes", group = !!get_group(.)),
            crop_previously = percent_response(agricultural_activities_prior2011, ., "crop_production_activity", group = !!get_group(.)),
            livestock_previously = percent_response(agricultural_activities_prior2011, ., "livestock_activity", group = !!get_group(.)),
            fishing_previously = percent_response(agricultural_activities_prior2011, ., "fishing_activity", group = !!get_group(.)),
            other_activity_previously = percent_response(agricultural_activities_prior2011, ., "other", group = !!get_group(.)),
            crop_prod_challenges_1_name = select_percents(crop_production_challenges, 1, ., questions, choices, "label", group = !!get_group(.)),
            crop_prod_challenges_1_pct = select_percents(crop_production_challenges, 1, ., questions, choices, "percent", group = !!get_group(.)),
            crop_prod_challenges_2_name = select_percents(crop_production_challenges, 2, ., questions, choices, "label", group = !!get_group(.)),
            crop_prod_challenges_2_pct = select_percents(crop_production_challenges, 2, ., questions, choices, "percent", group = !!get_group(.)),
            crop_prod_challenges_3_name = select_percents(crop_production_challenges, 3, ., questions, choices, "label", group = !!get_group(.)),
            crop_prod_challenges_3_pct = select_percents(crop_production_challenges, 3, ., questions, choices, "percent", group = !!get_group(.)),
            crop_prod_challenges_4_name = select_percents(crop_production_challenges, 4, ., questions, choices, "label", group = !!get_group(.)),
            crop_prod_challenges_4_pct = select_percents(crop_production_challenges, 4, ., questions, choices, "percent", group = !!get_group(.)),
            livestock_prod_challenges_1_name = select_percents(livestock_production_challenges, 1, ., questions, choices, "label", group = !!get_group(.)),
            livestock_prod_challenges_1_pct = select_percents(livestock_production_challenges, 1, ., questions, choices, "percent", group = !!get_group(.)),
            livestock_prod_challenges_2_name = select_percents(livestock_production_challenges, 2, ., questions, choices, "label", group = !!get_group(.)),
            livestock_prod_challenges_2_pct = select_percents(livestock_production_challenges, 2, ., questions, choices, "percent", group = !!get_group(.)),
            livestock_prod_challenges_3_name = select_percents(livestock_production_challenges, 3, ., questions, choices, "label", group = !!get_group(.)),
            livestock_prod_challenges_3_pct = select_percents(livestock_production_challenges, 3, ., questions, choices, "percent", group = !!get_group(.)),
            livestock_prod_challenges_4_name = select_percents(livestock_production_challenges, 4, ., questions, choices, "label", group = !!get_group(.)),
            livestock_prod_challenges_4_pct = select_percents(livestock_production_challenges, 4, ., questions, choices, "percent", group = !!get_group(.)),
            fishing_challenges_1_name = select_percents(fishing_challenges, 1, ., questions, choices, "label", group = !!get_group(.)),
            fishing_challenges_1_pct = select_percents(fishing_challenges, 1, ., questions, choices, "percent", group = !!get_group(.)),
            fishing_challenges_2_name = select_percents(fishing_challenges, 2, ., questions, choices, "label", group = !!get_group(.)),
            fishing_challenges_2_pct = select_percents(fishing_challenges, 2, ., questions, choices, "percent", group = !!get_group(.)),
            fishing_challenges_3_name = select_percents(fishing_challenges, 3, ., questions, choices, "label", group = !!get_group(.)),
            fishing_challenges_3_pct = select_percents(fishing_challenges, 3, ., questions, choices, "percent", group = !!get_group(.)),
            fishing_challenges_4_name = select_percents(fishing_challenges, 4, ., questions, choices, "label", group = !!get_group(.)),
            fishing_challenges_4_pct = select_percents(fishing_challenges, 4, ., questions, choices, "percent", group = !!get_group(.)),
            type_crops_1_name = select_percents(types_crops, 1, ., questions, choices, "label", group = !!get_group(.)),
            type_crops_1_pct = select_percents(types_crops, 1, ., questions, choices, "percent", group = !!get_group(.)),
            type_crops_2_name = select_percents(types_crops, 2, ., questions, choices, "label", group = !!get_group(.)),
            type_crops_2_pct = select_percents(types_crops, 2, ., questions, choices, "percent", group = !!get_group(.)),
            type_crops_3_name = select_percents(types_crops, 3, ., questions, choices, "label", group = !!get_group(.)),
            type_crops_3_pct = select_percents(types_crops, 3, ., questions, choices, "percent", group = !!get_group(.)),
            crop_prod_impacted = percent_response(crisis_affected_crop_production, ., "yes", group = !!get_group(.)),
            livestock_prod_impacted = percent_response(crisis_affected_livestock_production, ., "yes", group = !!get_group(.)),
            returnee_adults = weighted_sum(filter(., displacement_status == "returnee")[["nb_over18"]],
                                           filter(., displacement_status == "returnee"),
                                           "nb_over18",
                                           group = !!get_group(.)),
            returnee_adult_perm_job = weighted_sum(filter(., displacement_status == "returnee")[["permanent_job_adult"]],
                                                   filter(., displacement_status == "returnee"),
                                                   "permanent_job_adult", group = !!get_group(.)),
            returnee_adult_temp_job = weighted_sum(filter(., displacement_status == "returnee")[["temporary_job_adult"]],
                                                   filter(., displacement_status == "returnee"),
                                                   "temporary_job_adult", group = !!get_group(.)),
            returnee_adult_daily_labour = weighted_sum(filter(., displacement_status == "returnee")[["daily_labour_job_adult"]],
                                                       filter(., displacement_status == "returnee"),
                                                       "daily_labour_job_adult", group = !!get_group(.)),
            returnee_adult_gvt_payroll = weighted_sum(filter(., displacement_status == "returnee")[["gvt_payroll_job_adult"]],
                                                      filter(., displacement_status == "returnee"),
                                                      "gvt_payroll_job_adult", group = !!get_group(.)),
            idp_adults = weighted_sum(filter(., displacement_status == "idp")[["nb_over18"]],
                                      filter(., displacement_status == "idp"),
                                      "nb_over18",
                                      group = !!get_group(.)),
            idp_adult_perm_job = weighted_sum(filter(., displacement_status == "idp")[["permanent_job_adult"]],
                                              filter(., displacement_status == "idp"),
                                              "permanent_job_adult", group = !!get_group(.)),
            idp_adult_temp_job = weighted_sum(filter(., displacement_status == "idp")[["temporary_job_adult"]],
                                              filter(., displacement_status == "idp"),
                                              "temporary_job_adult", group = !!get_group(.)),
            idp_adult_daily_labour = weighted_sum(filter(., displacement_status == "idp")[["daily_labour_job_adult"]],
                                                  filter(., displacement_status == "idp"),
                                                  "daily_labour_job_adult", group = !!get_group(.)),
            idp_adult_gvt_payroll = weighted_sum(filter(., displacement_status == "idp")[["gvt_payroll_job_adult"]],
                                                 filter(., displacement_status == "idp"),
                                                 "gvt_payroll_job_adult", group = !!get_group(.)),
            non_displaced_adults = weighted_sum(filter(., displacement_status == "non_displaced")[["nb_over18"]],
                                                filter(., displacement_status == "non_displaced"),
                                                "nb_over18",
                                                group = !!get_group(.)),
            non_displaced_adult_perm_job = weighted_sum(filter(., displacement_status == "non_displaced")[["permanent_job_adult"]],
                                                        filter(., displacement_status == "non_displaced"),
                                                        "permanent_job_adult", group = !!get_group(.)),
            non_displaced_adult_temp_job = weighted_sum(filter(., displacement_status == "non_displaced")[["temporary_job_adult"]],
                                                        filter(., displacement_status == "non_displaced"),
                                                        "temporary_job_adult", group = !!get_group(.)),
            non_displaced_adult_daily_labour = weighted_sum(filter(., displacement_status == "non_displaced")[["daily_labour_job_adult"]],
                                                            filter(., displacement_status == "non_displaced"),
                                                            "daily_labour_job_adult", group = !!get_group(.)),
            non_displaced_adult_gvt_payroll = weighted_sum(filter(., displacement_status == "non_displaced")[["gvt_payroll_job_adult"]],
                                                           filter(., displacement_status == "non_displaced"),
                                                           "gvt_payroll_job_adult", group = !!get_group(.)),
            returnee_minors = weighted_sum(filter(., displacement_status == "returnee")[["nb_under18"]],
                                           filter(., displacement_status == "returnee"),
                                           "nb_under18", group = !!get_group(.)),
            returnee_minor_perm_job = weighted_sum(filter(., displacement_status == "returnee")[["permanent_job_minor"]],
                                                   filter(., displacement_status == "returnee"),
                                                   "permanent_job_minor", group = !!get_group(.)),
            returnee_minor_temp_job = weighted_sum(filter(., displacement_status == "returnee")[["temporary_job_minor"]],
                                                   filter(., displacement_status == "returnee"),
                                                   "temporary_job_minor", group = !!get_group(.)),
            returnee_minor_daily_labour = weighted_sum(filter(., displacement_status == "returnee")[["daily_labour_job_minor"]],
                                                       filter(., displacement_status == "returnee"),
                                                       "daily_labour_job_minor", group = !!get_group(.)),
            idp_minors = weighted_sum(filter(., displacement_status == "idp")[["nb_under18"]],
                                      filter(., displacement_status == "idp"),
                                      "nb_under18", group = !!get_group(.)),
            idp_minor_perm_job = weighted_sum(filter(., displacement_status == "idp")[["permanent_job_minor"]],
                                              filter(., displacement_status == "idp"),
                                              "permanent_job_minor", group = !!get_group(.)),
            idp_minor_temp_job = weighted_sum(filter(., displacement_status == "idp")[["temporary_job_minor"]],
                                              filter(., displacement_status == "idp"),
                                              "temporary_job_minor", group = !!get_group(.)),
            idp_minor_daily_labour = weighted_sum(filter(., displacement_status == "idp")[["daily_labour_job_minor"]],
                                                  filter(., displacement_status == "idp"),
                                                  "daily_labour_job_minor", group = !!get_group(.)),
            non_displaced_minors = weighted_sum(filter(., displacement_status == "non_displaced")[["nb_under18"]],
                                                filter(., displacement_status == "non_displaced"),
                                                "nb_under18", group = !!get_group(.)),
            non_displaced_minor_perm_job = weighted_sum(filter(., displacement_status == "non_displaced")[["permanent_job_minor"]],
                                                        filter(., displacement_status == "non_displaced"),
                                                        "permanent_job_minor", group = !!get_group(.)),
            non_displaced_minor_temp_job = weighted_sum(filter(., displacement_status == "non_displaced")[["temporary_job_minor"]],
                                                        filter(., displacement_status == "non_displaced"),
                                                        "temporary_job_minor", group = !!get_group(.)),
            non_displaced_minor_daily_labour = weighted_sum(filter(., displacement_status == "non_displaced")[["daily_labour_job_minor"]],
                                                            filter(., displacement_status == "non_displaced"),
                                                            "daily_labour_job_minor", group = !!get_group(.)),
            total_working_male = weighted_sum(calcul_type_institution_male, ., group = !!get_group(.)),
            gvt_public_sector_male = round(100 * weighted_sum(gvt_public_sector_male, ., group = !!get_group(.)) / total_working_male, 0),
            libyan_owned_business_male = round(100 * weighted_sum(libyan_owned_business_male, ., group = !!get_group(.)) / total_working_male, 0),
            foreign_owned_business_male = round(100 * weighted_sum(foreign_owned_business_male, ., group = !!get_group(.)) / total_working_male, 0),
            libyan_ngos_csos_male = round(100 * weighted_sum(libyan_ngos_csos_male, ., group = !!get_group(.)) / total_working_male, 0),
            international_ngos_male = round(100 * weighted_sum(international_ngos_male, ., group = !!get_group(.)) / total_working_male, 0),
            own_family_business_male = round(100 * weighted_sum(own_family_business_male, ., group = !!get_group(.)) / total_working_male, 0),
            informal_irregular_labour_male = round(100 * weighted_sum(informal_irregular_labour_male, ., group = !!get_group(.)) / total_working_male, 0),
            other_institution_male = round(100 * weighted_sum(other_institution_male, ., group = !!get_group(.)) / total_working_male, 0),
            total_working_female = weighted_sum(calcul_type_institution_female, ., group = !!get_group(.)),
            gvt_public_sector_female = round(100 * weighted_sum(gvt_public_sector_female, ., group = !!get_group(.)) / total_working_female, 0),
            libyan_owned_business_female = round(100 * weighted_sum(libyan_owned_business_female, ., group = !!get_group(.)) / total_working_female, 0),
            foreign_owned_business_female = round(100 * weighted_sum(foreign_owned_business_female, ., group = !!get_group(.)) / total_working_female, 0),
            libyan_ngos_csos_female = round(100 * weighted_sum(libyan_ngos_csos_female, ., group = !!get_group(.)) / total_working_female, 0),
            international_ngos_female = round(100 * weighted_sum(international_ngos_female, ., group = !!get_group(.)) / total_working_female, 0),
            own_family_business_female = round(100 * weighted_sum(own_family_business_female, ., group = !!get_group(.)) / total_working_female, 0),
            informal_irregular_labour_female = round(100 * weighted_sum(informal_irregular_labour_female, ., group = !!get_group(.)) / total_working_female, 0),
            other_institution_female = round(100 * weighted_sum(other_institution_female, ., group = !!get_group(.)) / total_working_female, 0),
            returnee_gvt_salary = weighted_median(filter(., displacement_status == "returnee")[["gvt_salary"]],
                                                  filter(., displacement_status == "returnee"),
                                                  x_name = "gvt_salary", group = !!get_group(.)),
            returnee_gvt_social_benefits = weighted_median(filter(., displacement_status == "returnee")[["gvt_social_benefits"]],
                                                           filter(., displacement_status == "returnee"),
                                                           x_name = "gvt_social_benefits", group = !!get_group(.)),
            returnee_non_gvt_salary = weighted_median(filter(., displacement_status == "returnee")[["non_gvt_salary"]],
                                                      filter(., displacement_status == "returnee"),
                                                      x_name = "non_gvt_salary", group = !!get_group(.)),
            returnee_casual_labour = weighted_median(filter(., displacement_status == "returnee")[["casual_labour"]],
                                                     filter(., displacement_status == "returnee"),
                                                     x_name = "casual_labour", group = !!get_group(.)),
            returnee_own_business_income = weighted_median(filter(., displacement_status == "returnee")[["own_business_income"]],
                                                           filter(., displacement_status == "returnee"),
                                                           x_name = "own_business_income", group = !!get_group(.)),
            returnee_remittances = weighted_median(filter(., displacement_status == "returnee")[["remittances"]],
                                                   filter(., displacement_status == "returnee"),
                                                   x_name = "remittances", group = !!get_group(.)),
            returnee_family_support = weighted_median(filter(., displacement_status == "returnee")[["family_support"]],
                                                      filter(., displacement_status == "returnee"),
                                                      x_name = "family_support", group = !!get_group(.)),
            returnee_humanitarian_assistance = weighted_median(filter(., displacement_status == "returnee")[["humanitarian_assistance"]],
                                                               filter(., displacement_status == "returnee"),
                                                               x_name = "humanitarian_assistance", group = !!get_group(.)),
            returnee_zakat = weighted_median(filter(., displacement_status == "returnee")[["zakat"]],
                                             filter(., displacement_status == "returnee"),
                                             x_name = "zakat", group = !!get_group(.)),
            returnee_income_other = weighted_median(filter(., displacement_status == "returnee")[["income_other"]],
                                                    filter(., displacement_status == "returnee"),
                                                    x_name = "income_other", group = !!get_group(.)),
            idp_gvt_salary = weighted_median(filter(., displacement_status == "idp")[["gvt_salary"]],
                                             filter(., displacement_status == "idp"),
                                             x_name = "gvt_salary", group = !!get_group(.)),
            idp_gvt_social_benefits = weighted_median(filter(., displacement_status == "idp")[["gvt_social_benefits"]],
                                                      filter(., displacement_status == "idp"),
                                                      x_name = "gvt_social_benefits", group = !!get_group(.)),
            idp_non_gvt_salary = weighted_median(filter(., displacement_status == "idp")[["non_gvt_salary"]],
                                                 filter(., displacement_status == "idp"),
                                                 x_name = "non_gvt_salary", group = !!get_group(.)),
            idp_casual_labour = weighted_median(filter(., displacement_status == "idp")[["casual_labour"]],
                                                filter(., displacement_status == "idp"),
                                                x_name = "casual_labour", group = !!get_group(.)),
            idp_own_business_income = weighted_median(filter(., displacement_status == "idp")[["own_business_income"]],
                                                      filter(., displacement_status == "idp"),
                                                      x_name = "own_business_income", group = !!get_group(.)),
            idp_remittances = weighted_median(filter(., displacement_status == "idp")[["remittances"]],
                                              filter(., displacement_status == "idp"),
                                              x_name = "remittances", group = !!get_group(.)),
            idp_family_support = weighted_median(filter(., displacement_status == "idp")[["family_support"]],
                                                 filter(., displacement_status == "idp"),
                                                 x_name = "family_support", group = !!get_group(.)),
            idp_humanitarian_assistance = weighted_median(filter(., displacement_status == "idp")[["humanitarian_assistance"]],
                                                          filter(., displacement_status == "idp"),
                                                          x_name = "humanitarian_assistance", group = !!get_group(.)),
            idp_zakat = weighted_median(filter(., displacement_status == "idp")[["zakat"]],
                                        filter(., displacement_status == "idp"),
                                        x_name = "zakat", group = !!get_group(.)),
            idp_income_other = weighted_median(filter(., displacement_status == "idp")[["income_other"]],
                                               filter(., displacement_status == "idp"),
                                               x_name = "income_other", group = !!get_group(.)),
            non_displaced_gvt_salary = weighted_median(filter(., displacement_status == "non_displaced")[["gvt_salary"]],
                                                       filter(., displacement_status == "non_displaced"),
                                                       x_name = "gvt_salary", group = !!get_group(.)),
            non_displaced_gvt_social_benefits = weighted_median(filter(., displacement_status == "non_displaced")[["gvt_social_benefits"]],
                                                                filter(., displacement_status == "non_displaced"),
                                                                x_name = "gvt_social_benefits", group = !!get_group(.)),
            non_displaced_non_gvt_salary = weighted_median(filter(., displacement_status == "non_displaced")[["non_gvt_salary"]],
                                                           filter(., displacement_status == "non_displaced"),
                                                           x_name = "non_gvt_salary", group = !!get_group(.)),
            non_displaced_casual_labour = weighted_median(filter(., displacement_status == "non_displaced")[["casual_labour"]],
                                                          filter(., displacement_status == "non_displaced"),
                                                          x_name = "casual_labour", group = !!get_group(.)),
            non_displaced_own_business_income = weighted_median(filter(., displacement_status == "non_displaced")[["own_business_income"]],
                                                                filter(., displacement_status == "non_displaced"),
                                                                x_name = "own_business_income", group = !!get_group(.)),
            non_displaced_remittances = weighted_median(filter(., displacement_status == "non_displaced")[["remittances"]],
                                                        filter(., displacement_status == "non_displaced"),
                                                        x_name = "remittances", group = !!get_group(.)),
            non_displaced_family_support = weighted_median(filter(., displacement_status == "non_displaced")[["family_support"]],
                                                           filter(., displacement_status == "non_displaced"),
                                                           x_name = "family_support", group = !!get_group(.)),
            non_displaced_humanitarian_assistance = weighted_median(filter(., displacement_status == "non_displaced")[["humanitarian_assistance"]],
                                                                    filter(., displacement_status == "non_displaced"),
                                                                    x_name = "humanitarian_assistance", group = !!get_group(.)),
            non_displaced_zakat = weighted_median(filter(., displacement_status == "non_displaced")[["zakat"]],
                                                  filter(., displacement_status == "non_displaced"),
                                                  x_name = "zakat", group = !!get_group(.)),
            non_displaced_income_other = weighted_median(filter(., displacement_status == "non_displaced")[["income_other"]],
                                                         filter(., displacement_status == "non_displaced"),
                                                         x_name = "income_other", group = !!get_group(.)),
            returnee_cash_challenges = percent_response(filter(., displacement_status == "returnee")[["obtaining_cash_challenge"]],
                                                        filter(., displacement_status == "returnee"),
                                                        "yes",
                                                        x_name = "obtaining_cash_challenge", group = !!get_group(.)),
            idp_cash_challenges = percent_response(filter(., displacement_status == "idp")[["obtaining_cash_challenge"]],
                                                   filter(., displacement_status == "idp"),
                                                   "yes",
                                                   x_name = "obtaining_cash_challenge", group = !!get_group(.)),
            non_displaced_cash_challenges = percent_response(filter(., displacement_status == "non_displaced")[["obtaining_cash_challenge"]],
                                                             filter(., displacement_status == "non_displaced"),
                                                             "yes",
                                                             x_name = "obtaining_cash_challenge", group = !!get_group(.)),
            cash_challenge_1_name = select_percents(obtaining_cash_challenge_reasons, 1, ., questions, choices, "label", group = !!get_group(.)),
            cash_challenge_1_pct = select_percents(obtaining_cash_challenge_reasons, 1, ., questions, choices, "percent", group = !!get_group(.)),
            cash_challenge_2_name = select_percents(obtaining_cash_challenge_reasons, 2, ., questions, choices, "label", group = !!get_group(.)),
            cash_challenge_2_pct = select_percents(obtaining_cash_challenge_reasons, 2, ., questions, choices, "percent", group = !!get_group(.)),
            cash_challenge_3_name = select_percents(obtaining_cash_challenge_reasons, 3, ., questions, choices, "label", group = !!get_group(.)),
            cash_challenge_3_pct = select_percents(obtaining_cash_challenge_reasons, 3, ., questions, choices, "percent", group = !!get_group(.)),
            cash_challenge_4_name = select_percents(obtaining_cash_challenge_reasons, 4, ., questions, choices, "label", group = !!get_group(.)),
            cash_challenge_4_pct = select_percents(obtaining_cash_challenge_reasons, 4, ., questions, choices, "percent", group = !!get_group(.)),
            returnee_food_expenditure = weighted_median(filter(., displacement_status == "returnee")[["food_expenditure"]],
                                                        filter(., displacement_status == "returnee"),
                                                        x_name = "food_expenditure", group = !!get_group(.)),
            returnee_rent_expenditure = weighted_median(filter(., displacement_status == "returnee")[["rent_expenditure"]],
                                                        filter(., displacement_status == "returnee"),
                                                        x_name = "rent_expenditure", group = !!get_group(.)),
            returnee_shelter_maintenance_expenditure = weighted_median(filter(., displacement_status == "returnee")[["shelter_maintenance_expenditure"]],
                                                                       filter(., displacement_status == "returnee"),
                                                                       x_name = "shelter_maintenance_expenditure", group = !!get_group(.)),
            returnee_water_expenditure = weighted_median(filter(., displacement_status == "returnee")[["water_expenditure"]],
                                                         filter(., displacement_status == "returnee"),
                                                         x_name = "water_expenditure", group = !!get_group(.)),
            returnee_nfi_expenditure = weighted_median(filter(., displacement_status == "returnee")[["nfi_expenditure"]],
                                                       filter(., displacement_status == "returnee"),
                                                       x_name = "nfi_expenditure", group = !!get_group(.)),
            returnee_utilities_expenditure = weighted_median(filter(., displacement_status == "returnee")[["utilities_expenditure"]],
                                                             filter(., displacement_status == "returnee"),
                                                             x_name = "utilities_expenditure", group = !!get_group(.)),
            returnee_fuel_expenditure = weighted_median(filter(., displacement_status == "returnee")[["fuel_expenditure"]],
                                                        filter(., displacement_status == "returnee"),
                                                        x_name = "fuel_expenditure", group = !!get_group(.)),
            returnee_health_related_expenditure = weighted_median(filter(., displacement_status == "returnee")[["health_related_expenditure"]],
                                                                  filter(., displacement_status == "returnee"),
                                                                  x_name = "health_related_expenditure", group = !!get_group(.)),
            returnee_education_related_expenditure = weighted_median(filter(., displacement_status == "returnee")[["education_related_expenditure"]],
                                                                     filter(., displacement_status == "returnee"),
                                                                     x_name = "education_related_expenditure", group = !!get_group(.)),
            returnee_transportation_expenditure = weighted_median(filter(., displacement_status == "returnee")[["transportation_expenditure"]],
                                                                  filter(., displacement_status == "returnee"),
                                                                  x_name = "transportation_expenditure", group = !!get_group(.)),
            returnee_mobile_phone_credit_expenditure = weighted_median(filter(., displacement_status == "returnee")[["mobile_phone_credit_expenditure"]],
                                                                       filter(., displacement_status == "returnee"),
                                                                       x_name = "mobile_phone_credit_expenditure", group = !!get_group(.)),
            returnee_productive_assets_expenditure = weighted_median(filter(., displacement_status == "returnee")[["productive_assets_expenditure"]],
                                                                     filter(., displacement_status == "returnee"),
                                                                     x_name = "productive_assets_expenditure", group = !!get_group(.)),
            returnee_debt_repayment_expenditure = weighted_median(filter(., displacement_status == "returnee")[["debt_repayment_expenditure"]],
                                                                  filter(., displacement_status == "returnee"),
                                                                  x_name = "debt_repayment_expenditure", group = !!get_group(.)),
            returnee_other_expenditure = weighted_median(filter(., displacement_status == "returnee")[["other_expenditure"]],
                                                         filter(., displacement_status == "returnee"),
                                                         x_name = "other_expenditure", group = !!get_group(.)),
            idp_food_expenditure = weighted_median(filter(., displacement_status == "idp")[["food_expenditure"]],
                                                   filter(., displacement_status == "idp"),
                                                   x_name = "food_expenditure", group = !!get_group(.)),
            idp_rent_expenditure = weighted_median(filter(., displacement_status == "idp")[["rent_expenditure"]],
                                                   filter(., displacement_status == "idp"),
                                                   x_name = "rent_expenditure", group = !!get_group(.)),
            idp_shelter_maintenance_expenditure = weighted_median(filter(., displacement_status == "idp")[["shelter_maintenance_expenditure"]],
                                                                  filter(., displacement_status == "idp"),
                                                                  x_name = "shelter_maintenance_expenditure", group = !!get_group(.)),
            idp_water_expenditure = weighted_median(filter(., displacement_status == "idp")[["water_expenditure"]],
                                                    filter(., displacement_status == "idp"),
                                                    x_name = "water_expenditure", group = !!get_group(.)),
            idp_nfi_expenditure = weighted_median(filter(., displacement_status == "idp")[["nfi_expenditure"]],
                                                  filter(., displacement_status == "idp"),
                                                  x_name = "nfi_expenditure", group = !!get_group(.)),
            idp_utilities_expenditure = weighted_median(filter(., displacement_status == "idp")[["utilities_expenditure"]],
                                                        filter(., displacement_status == "idp"),
                                                        x_name = "utilities_expenditure", group = !!get_group(.)),
            idp_fuel_expenditure = weighted_median(filter(., displacement_status == "idp")[["fuel_expenditure"]],
                                                   filter(., displacement_status == "idp"),
                                                   x_name = "fuel_expenditure", group = !!get_group(.)),
            idp_health_related_expenditure = weighted_median(filter(., displacement_status == "idp")[["health_related_expenditure"]],
                                                             filter(., displacement_status == "idp"),
                                                             x_name = "health_related_expenditure", group = !!get_group(.)),
            idp_education_related_expenditure = weighted_median(filter(., displacement_status == "idp")[["education_related_expenditure"]],
                                                                filter(., displacement_status == "idp"),
                                                                x_name = "education_related_expenditure", group = !!get_group(.)),
            idp_transportation_expenditure = weighted_median(filter(., displacement_status == "idp")[["transportation_expenditure"]],
                                                             filter(., displacement_status == "idp"),
                                                             x_name = "transportation_expenditure", group = !!get_group(.)),
            idp_mobile_phone_credit_expenditure = weighted_median(filter(., displacement_status == "idp")[["mobile_phone_credit_expenditure"]],
                                                                  filter(., displacement_status == "idp"),
                                                                  x_name = "mobile_phone_credit_expenditure", group = !!get_group(.)),
            idp_productive_assets_expenditure = weighted_median(filter(., displacement_status == "idp")[["productive_assets_expenditure"]],
                                                                filter(., displacement_status == "idp"),
                                                                x_name = "productive_assets_expenditure", group = !!get_group(.)),
            idp_debt_repayment_expenditure = weighted_median(filter(., displacement_status == "idp")[["debt_repayment_expenditure"]],
                                                             filter(., displacement_status == "idp"),
                                                             x_name = "debt_repayment_expenditure", group = !!get_group(.)),
            idp_other_expenditure = weighted_median(filter(., displacement_status == "idp")[["other_expenditure"]],
                                                    filter(., displacement_status == "idp"),
                                                    x_name = "other_expenditure", group = !!get_group(.)),
            non_displaced_food_expenditure = weighted_median(filter(., displacement_status == "non_displaced")[["food_expenditure"]],
                                                             filter(., displacement_status == "non_displaced"),
                                                             x_name = "food_expenditure", group = !!get_group(.)),
            non_displaced_rent_expenditure = weighted_median(filter(., displacement_status == "non_displaced")[["rent_expenditure"]],
                                                             filter(., displacement_status == "non_displaced"),
                                                             x_name = "rent_expenditure", group = !!get_group(.)),
            non_displaced_shelter_maintenance_expenditure = weighted_median(filter(., displacement_status == "non_displaced")[["shelter_maintenance_expenditure"]],
                                                                            filter(., displacement_status == "non_displaced"),
                                                                            x_name = "shelter_maintenance_expenditure", group = !!get_group(.)),
            non_displaced_water_expenditure = weighted_median(filter(., displacement_status == "non_displaced")[["water_expenditure"]],
                                                              filter(., displacement_status == "non_displaced"),
                                                              x_name = "water_expenditure", group = !!get_group(.)),
            non_displaced_nfi_expenditure = weighted_median(filter(., displacement_status == "non_displaced")[["nfi_expenditure"]],
                                                            filter(., displacement_status == "non_displaced"),
                                                            x_name = "nfi_expenditure", group = !!get_group(.)),
            non_displaced_utilities_expenditure = weighted_median(filter(., displacement_status == "non_displaced")[["utilities_expenditure"]],
                                                                  filter(., displacement_status == "non_displaced"),
                                                                  x_name = "utilities_expenditure", group = !!get_group(.)),
            non_displaced_fuel_expenditure = weighted_median(filter(., displacement_status == "non_displaced")[["fuel_expenditure"]],
                                                             filter(., displacement_status == "non_displaced"),
                                                             x_name = "fuel_expenditure", group = !!get_group(.)),
            non_displaced_health_related_expenditure = weighted_median(filter(., displacement_status == "non_displaced")[["health_related_expenditure"]],
                                                                       filter(., displacement_status == "non_displaced"),
                                                                       x_name = "health_related_expenditure", group = !!get_group(.)),
            non_displaced_education_related_expenditure = weighted_median(filter(., displacement_status == "non_displaced")[["education_related_expenditure"]],
                                                                          filter(., displacement_status == "non_displaced"),
                                                                          x_name = "education_related_expenditure", group = !!get_group(.)),
            non_displaced_transportation_expenditure = weighted_median(filter(., displacement_status == "non_displaced")[["transportation_expenditure"]],
                                                                       filter(., displacement_status == "non_displaced"),
                                                                       x_name = "transportation_expenditure", group = !!get_group(.)),
            non_displaced_mobile_phone_credit_expenditure = weighted_median(filter(., displacement_status == "non_displaced")[["mobile_phone_credit_expenditure"]],
                                                                            filter(., displacement_status == "non_displaced"),
                                                                            x_name = "mobile_phone_credit_expenditure", group = !!get_group(.)),
            non_displaced_productive_assets_expenditure = weighted_median(filter(., displacement_status == "non_displaced")[["productive_assets_expenditure"]],
                                                                          filter(., displacement_status == "non_displaced"),
                                                                          x_name = "productive_assets_expenditure", group = !!get_group(.)),
            non_displaced_debt_repayment_expenditure = weighted_median(filter(., displacement_status == "non_displaced")[["debt_repayment_expenditure"]],
                                                                       filter(., displacement_status == "non_displaced"),
                                                                       x_name = "debt_repayment_expenditure", group = !!get_group(.)),
            non_displaced_other_expenditure = weighted_median(filter(., displacement_status == "non_displaced")[["other_expenditure"]],
                                                              filter(., displacement_status == "non_displaced"),
                                                              x_name = "other_expenditure", group = !!get_group(.)),
            payment_modality_1_name = select_percents(hh_payment_modality, 1, ., questions, choices, "label", group = !!get_group(.)),
            payment_modality_1_pct = select_percents(hh_payment_modality, 1, ., questions, choices, "percent", group = !!get_group(.)),
            payment_modality_2_name = select_percents(hh_payment_modality, 2, ., questions, choices, "label", group = !!get_group(.)),
            payment_modality_2_pct = select_percents(hh_payment_modality, 2, ., questions, choices, "percent", group = !!get_group(.)),
            payment_modality_3_name = select_percents(hh_payment_modality, 3, ., questions, choices, "label", group = !!get_group(.)),
            payment_modality_3_pct = select_percents(hh_payment_modality, 3, ., questions, choices, "percent", group = !!get_group(.)),
            payment_modality_4_name = select_percents(hh_payment_modality, 4, ., questions, choices, "label", group = !!get_group(.)),
            payment_modality_4_pct = select_percents(hh_payment_modality, 4, ., questions, choices, "percent", group = !!get_group(.)),
            no_market_access = percent_response(hh_access_marketplace, ., "no", group = !!get_group(.)),
            distance_market_less_15 = percent_response(travel_to_market, ., "less_15min", group = !!get_group(.)),
            distance_market_15_30 = percent_response(travel_to_market, ., "between_15_29min", group = !!get_group(.)),
            distance_market_more_30 = percent_response(travel_to_market, ., "between_30_59min", "between_1_2hours", "more_2hours", group = !!get_group(.)),
            no_barriers_access_market = percent_response(barriers_access_market, ., "no_barriers_access_market", group = !!get_group(.)),
            market_barriers_1_name = select_percents(barriers_access_market, 1, ., questions, choices, "label", exclude = "no_barriers_access_market", group = !!get_group(.)),
            market_barriers_1_pct = select_percents(barriers_access_market, 1, ., questions, choices, "percent", exclude = "no_barriers_access_market", group = !!get_group(.)),
            market_barriers_2_name = select_percents(barriers_access_market, 2, ., questions, choices, "label", exclude = "no_barriers_access_market", group = !!get_group(.)),
            market_barriers_2_pct = select_percents(barriers_access_market, 2, ., questions, choices, "percent", exclude = "no_barriers_access_market", group = !!get_group(.)),
            market_barriers_3_name = select_percents(barriers_access_market, 3, ., questions, choices, "label", exclude = "no_barriers_access_market", group = !!get_group(.)),
            market_barriers_3_pct = select_percents(barriers_access_market, 3, ., questions, choices, "percent", exclude = "no_barriers_access_market", group = !!get_group(.)),
            item_barrier_too_expensive = percent_response(barriers_purchasing_items, ., "yes_items_too_expensive", group = !!get_group(.)),
            item_barrier_not_available = percent_response(barriers_purchasing_items, ., "yes_items_not_available", group = !!get_group(.)),
            item_too_expensive_1_name = select_percents(expensive_items_to_afford, 1, ., questions, choices, "label", group = !!get_group(.)),
            item_too_expensive_1_pct = select_percents(expensive_items_to_afford, 1, ., questions, choices, "percent", group = !!get_group(.)),
            item_too_expensive_2_name = select_percents(expensive_items_to_afford, 2, ., questions, choices, "label", group = !!get_group(.)),
            item_too_expensive_2_pct = select_percents(expensive_items_to_afford, 2, ., questions, choices, "percent", group = !!get_group(.)),
            item_too_expensive_3_name = select_percents(expensive_items_to_afford, 3, ., questions, choices, "label", group = !!get_group(.)),
            item_too_expensive_3_pct = select_percents(expensive_items_to_afford, 3, ., questions, choices, "percent", group = !!get_group(.)),
            item_not_available_1_name = select_percents(unabailable_items_marketplace, 1, ., questions, choices, "label", group = !!get_group(.)),
            item_not_available_1_pct = select_percents(unabailable_items_marketplace, 1, ., questions, choices, "percent", group = !!get_group(.)),
            item_not_available_2_name = select_percents(unabailable_items_marketplace, 2, ., questions, choices, "label", group = !!get_group(.)),
            item_not_available_2_pct = select_percents(unabailable_items_marketplace, 2, ., questions, choices, "percent", group = !!get_group(.)),
            item_not_available_3_name = select_percents(unabailable_items_marketplace, 3, ., questions, choices, "label", group = !!get_group(.)),
            item_not_available_3_pct = select_percents(unabailable_items_marketplace, 3, ., questions, choices, "percent", group = !!get_group(.)),
            returnee_cash_coping_stress = percent_response(filter(., displacement_status == "returnee")[["cash_coping"]],
                                                           filter(., displacement_status == "returnee"),
                                                           "stress",
                                                           x_name = "cash_coping", group = !!get_group(.)),
            returnee_cash_coping_crisis = percent_response(filter(., displacement_status == "returnee")[["cash_coping"]],
                                                           filter(., displacement_status == "returnee"),
                                                           "crisis",
                                                           x_name = "cash_coping", group = !!get_group(.)),
            returnee_cash_coping_emergency = percent_response(filter(., displacement_status == "returnee")[["cash_coping"]],
                                                              filter(., displacement_status == "returnee"),
                                                              "emergency",
                                                              x_name = "cash_coping", group = !!get_group(.)),
            idp_cash_coping_stress = percent_response(filter(., displacement_status == "idp")[["cash_coping"]],
                                                      filter(., displacement_status == "idp"),
                                                      "stress",
                                                      x_name = "cash_coping", group = !!get_group(.)),
            idp_cash_coping_crisis = percent_response(filter(., displacement_status == "idp")[["cash_coping"]],
                                                      filter(., displacement_status == "idp"),
                                                      "crisis",
                                                      x_name = "cash_coping", group = !!get_group(.)),
            idp_cash_coping_emergency = percent_response(filter(., displacement_status == "idp")[["cash_coping"]],
                                                         filter(., displacement_status == "idp"),
                                                         "emergency",
                                                         x_name = "cash_coping", group = !!get_group(.)),
            non_displaced_cash_coping_stress = percent_response(filter(., displacement_status == "non_displaced")[["cash_coping"]],
                                                                filter(., displacement_status == "non_displaced"),
                                                                "stress",
                                                                x_name = "cash_coping", group = !!get_group(.)),
            non_displaced_cash_coping_crisis = percent_response(filter(., displacement_status == "non_displaced")[["cash_coping"]],
                                                                filter(., displacement_status == "non_displaced"),
                                                                "crisis",
                                                                x_name = "cash_coping", group = !!get_group(.)),
            non_displaced_cash_coping_emergency = percent_response(filter(., displacement_status == "non_displaced")[["cash_coping"]],
                                                                   filter(., displacement_status == "non_displaced"),
                                                                   "emergency",
                                                                   x_name = "cash_coping", group = !!get_group(.)),
            cash_coping_reason_1_name = select_percents(using_cash_coping_mechanism_reasons, 1, ., questions, choices, "label", group = !!get_group(.)),
            cash_coping_reason_1_pct = select_percents(using_cash_coping_mechanism_reasons, 1, ., questions, choices, "percent", group = !!get_group(.)),
            cash_coping_reason_2_name = select_percents(using_cash_coping_mechanism_reasons, 2, ., questions, choices, "label", group = !!get_group(.)),
            cash_coping_reason_2_pct = select_percents(using_cash_coping_mechanism_reasons, 2, ., questions, choices, "percent", group = !!get_group(.)),
            cash_coping_reason_3_name = select_percents(using_cash_coping_mechanism_reasons, 3, ., questions, choices, "label", group = !!get_group(.)),
            cash_coping_reason_3_pct = select_percents(using_cash_coping_mechanism_reasons, 3, ., questions, choices, "percent", group = !!get_group(.)),
            cash_coping_reason_4_name = select_percents(using_cash_coping_mechanism_reasons, 4, ., questions, choices, "label", group = !!get_group(.)),
            cash_coping_reason_4_pct = select_percents(using_cash_coping_mechanism_reasons, 4, ., questions, choices, "percent", group = !!get_group(.)),
            cash_coping_reason_5_name = select_percents(using_cash_coping_mechanism_reasons, 5, ., questions, choices, "label", group = !!get_group(.)),
            cash_coping_reason_5_pct = select_percents(using_cash_coping_mechanism_reasons, 5, ., questions, choices, "percent", group = !!get_group(.)),
            cash_coping_reason_6_name = select_percents(using_cash_coping_mechanism_reasons, 6, ., questions, choices, "label", group = !!get_group(.)),
            cash_coping_reason_6_pct = select_percents(using_cash_coping_mechanism_reasons, 6, ., questions, choices, "percent", group = !!get_group(.)),
            apartment_house = percent_response(shelter_type, ., "apartment", "house", group = !!get_group(.)),
            unfinished_room = percent_response(shelter_type, ., "unfinished_rooms", group = !!get_group(.)),
            public_building = percent_response(shelter_type, ., "public_building_not_used_for_shelter", group = !!get_group(.)),
            private_building = percent_response(shelter_type, ., "private_building_not_used_for_shelter", group = !!get_group(.)),
            tent_caravan = percent_response(shelter_type, ., "tent_caravan", group = !!get_group(.)),
            temporary_shelter_ngos = percent_response(shelter_type, ., "temporary_shelter_ngos", group = !!get_group(.)),
            connection_house = percent_response(shelter_type, ., "connection_house", group = !!get_group(.)),
            hotel = percent_response(shelter_type, ., "hotel", group = !!get_group(.)),
            camp_informal_settlement = percent_response(shelter_type, ., "camp_informal_settlement", group = !!get_group(.)),
            other_housing = percent_response(shelter_type, ., "other", group = !!get_group(.)),
            returnee_occupancy_owned = percent_response(filter(., displacement_status == "returnee")[["occupancy_status"]],
                                                        filter(., displacement_status == "returnee"),
                                                        "ownership",
                                                        x_name = "occupancy_status", group = !!get_group(.)),
            returnee_occupancy_rented = percent_response(filter(., displacement_status == "returnee")[["occupancy_status"]],
                                                         filter(., displacement_status == "returnee"),
                                                         "rental_written_contract",
                                                         "rental_verbal_agreement",
                                                         x_name = "occupancy_status", group = !!get_group(.)),
            returnee_occupancy_hosted_free = percent_response(filter(., displacement_status == "returnee")[["occupancy_status"]],
                                                              filter(., displacement_status == "returnee"),
                                                              "hosted_free",
                                                              x_name = "occupancy_status", group = !!get_group(.)),
            returnee_occupancy_other = percent_response(filter(., displacement_status == "returnee")[["occupancy_status"]],
                                                        filter(., displacement_status == "returnee"),
                                                        "squatting",
                                                        "housing_provided_public_authority",
                                                        "housing_provided_employer",
                                                        "other",
                                                        x_name = "occupancy_status", group = !!get_group(.)),
            idp_occupancy_owned = percent_response(filter(., displacement_status == "idp")[["occupancy_status"]],
                                                   filter(., displacement_status == "idp"),
                                                   "ownership",
                                                   x_name = "occupancy_status", group = !!get_group(.)),
            idp_occupancy_rented = percent_response(filter(., displacement_status == "idp")[["occupancy_status"]],
                                                    filter(., displacement_status == "idp"),
                                                    "rental_written_contract",
                                                    "rental_verbal_agreement",
                                                    x_name = "occupancy_status", group = !!get_group(.)),
            idp_occupancy_hosted_free = percent_response(filter(., displacement_status == "idp")[["occupancy_status"]],
                                                         filter(., displacement_status == "idp"),
                                                         "hosted_free",
                                                         x_name = "occupancy_status", group = !!get_group(.)),
            idp_occupancy_other = percent_response(filter(., displacement_status == "idp")[["occupancy_status"]],
                                                   filter(., displacement_status == "idp"),
                                                   "squatting",
                                                   "housing_provided_public_authority",
                                                   "housing_provided_employer",
                                                   "other",
                                                   x_name = "occupancy_status", group = !!get_group(.)),
            non_displaced_occupancy_owned = percent_response(filter(., displacement_status == "non_displaced")[["occupancy_status"]],
                                                             filter(., displacement_status == "non_displaced"),
                                                             "ownership",
                                                             x_name = "occupancy_status", group = !!get_group(.)),
            non_displaced_occupancy_rented = percent_response(filter(., displacement_status == "non_displaced")[["occupancy_status"]],
                                                              filter(., displacement_status == "non_displaced"),
                                                              "rental_written_contract",
                                                              "rental_verbal_agreement",
                                                              x_name = "occupancy_status", group = !!get_group(.)),
            non_displaced_occupancy_hosted_free = percent_response(filter(., displacement_status == "non_displaced")[["occupancy_status"]],
                                                                   filter(., displacement_status == "non_displaced"),
                                                                   "hosted_free",
                                                                   x_name = "occupancy_status", group = !!get_group(.)),
            non_displaced_occupancy_other = percent_response(filter(., displacement_status == "non_displaced")[["occupancy_status"]],
                                                             filter(., displacement_status == "non_displaced"),
                                                             "squatting",
                                                             "housing_provided_public_authority",
                                                             "housing_provided_employer",
                                                             "other",
                                                             x_name = "occupancy_status", group = !!get_group(.)),
            returnee_rental_cost = weighted_median(filter(., displacement_status == "returnee")[["rental_cost"]],
                                                   filter(., displacement_status == "returnee"),
                                                   "rental_cost", group = !!get_group(.)),
            idp_rental_cost = weighted_median(filter(., displacement_status == "idp")[["rental_cost"]],
                                              filter(., displacement_status == "idp"),
                                              "rental_cost", group = !!get_group(.)),
            non_displaced_rental_cost = weighted_median(filter(., displacement_status == "non_displaced")[["rental_cost"]],
                                                        filter(., displacement_status == "non_displaced"),
                                                        "rental_cost", group = !!get_group(.)),
            threatened_eviction = percent_response(eviction_threat, ., "yes_threatened_with_eviction", group = !!get_group(.)),
            recently_evicted = percent_response(eviction_threat, ., "yes_recently_evicted", group = !!get_group(.)),
            eviction_reason_1_name = select_percents(eviction_shelter_reasons, 1, ., questions, choices, "label", group = !!get_group(.)),
            eviction_reason_1_pct = select_percents(eviction_shelter_reasons, 1, ., questions, choices, "percent", group = !!get_group(.)),
            eviction_reason_2_name = select_percents(eviction_shelter_reasons, 2, ., questions, choices, "label", group = !!get_group(.)),
            eviction_reason_2_pct = select_percents(eviction_shelter_reasons, 2, ., questions, choices, "percent", group = !!get_group(.)),
            eviction_reason_3_name = select_percents(eviction_shelter_reasons, 3, ., questions, choices, "label", group = !!get_group(.)),
            eviction_reason_3_pct = select_percents(eviction_shelter_reasons, 3, ., questions, choices, "percent", group = !!get_group(.)),
            nfi_need = percent_response(nfi_need, ., "has_nfi_need", group = !!get_group(.)),
            power_cuts = weighted_median(power_cuts, ., group = !!get_group(.)),
            phone_coverage_reliable = percent_response(phone_network_coverage, ., "coverage_exists_reliable", group = !!get_group(.)),
            phone_coverage_not_reliable = percent_response(phone_network_coverage, ., "coverage_exists_not_reliable", group = !!get_group(.)),
            phone_coverage_none = percent_response(phone_network_coverage, ., "coverage_doesnt_exist", group = !!get_group(.)),
            water_source_public_network = percent_response(primary_drinkingwater_source, ., "public_network", group = !!get_group(.)),
            water_source_bottles = percent_response(primary_drinkingwater_source, ., "bottled_water", group = !!get_group(.)),
            water_source_trucks = percent_response(primary_drinkingwater_source, ., "water_trucking", group = !!get_group(.)),
            water_source_other = percent_response(primary_drinkingwater_source, .,
                                                  "public_tap", "protected_well", "unprotected_well",
                                                  "surface_water", "rainwater", "other", group = !!get_group(.)),
            water_dist_100m = percent_response(distance_drinkingwater, ., "upto_100m", group = !!get_group(.)),
            water_dist_200m = percent_response(distance_drinkingwater, ., "between_101_200m", group = !!get_group(.)),
            water_dist_300m = percent_response(distance_drinkingwater, ., "between_201_300m", group = !!get_group(.)),
            water_dist_400m = percent_response(distance_drinkingwater, ., "between_301_400m", group = !!get_group(.)),
            water_dist_500m = percent_response(distance_drinkingwater, ., "between_401_500m", group = !!get_group(.)),
            water_dist_more_500m = percent_response(distance_drinkingwater, ., "more_500m", group = !!get_group(.)),
            returnee_water_insufficient = percent_response(filter(., displacement_status == "returnee")[["unsufficient_quantity_water"]],
                                                           filter(., displacement_status == "returnee"),
                                                           "yes",
                                                           x_name = "unsufficient_quantity_water", group = !!get_group(.)),
            idp_water_insufficient = percent_response(filter(., displacement_status == "idp")[["unsufficient_quantity_water"]],
                                                      filter(., displacement_status == "idp"),
                                                      "yes",
                                                      x_name = "unsufficient_quantity_water", group = !!get_group(.)),
            non_displaced_water_insufficient = percent_response(filter(., displacement_status == "non_displaced")[["unsufficient_quantity_water"]],
                                                                filter(., displacement_status == "non_displaced"),
                                                                "yes",
                                                                x_name = "unsufficient_quantity_water", group = !!get_group(.)),
            water_access_every_day = percent_response(access_public_water_network, ., "every_day", group = !!get_group(.)),
            water_access_most_days = percent_response(access_public_water_network, ., "most_days", group = !!get_group(.)),
            water_access_rarely_none = percent_response(access_public_water_network, ., "rarely", "not_at_all", group = !!get_group(.)),
            designated_waste_disposal = percent_response(trash_disposal, .,
                                                         "collected_municipality_waste_management_service",
                                                         "designated_place_waste_disposal", group = !!get_group(.)),
            healthcare_challenge_yes = percent_response(access_healthcare_challenge, ., "yes", group = !!get_group(.)),
            healthcare_challenge_no = percent_response(access_healthcare_challenge, ., "no", group = !!get_group(.)),
            healthcare_challenge_dk_na = percent_response(access_healthcare_challenge, ., "dk", "dwta", group = !!get_group(.)),
            returnee_healthcare_challenge_1_name = select_percents(filter(., displacement_status == "returnee")[["access_healthcare_challenge_reasons"]],
                                                                   1,
                                                                   filter(., displacement_status == "returnee"),
                                                                   questions,
                                                                   choices,
                                                                   "label",
                                                                   x_name = "access_healthcare_challenge_reasons", group = !!get_group(.)),
            returnee_healthcare_challenge_1_pct = select_percents(filter(., displacement_status == "returnee")[["access_healthcare_challenge_reasons"]],
                                                                  1,
                                                                  filter(., displacement_status == "returnee"),
                                                                  questions,
                                                                  choices,
                                                                  "percent",
                                                                  x_name = "access_healthcare_challenge_reasons", group = !!get_group(.)),
            returnee_healthcare_challenge_2_name = select_percents(filter(., displacement_status == "returnee")[["access_healthcare_challenge_reasons"]],
                                                                   2,
                                                                   filter(., displacement_status == "returnee"),
                                                                   questions,
                                                                   choices,
                                                                   "label",
                                                                   x_name = "access_healthcare_challenge_reasons", group = !!get_group(.)),
            returnee_healthcare_challenge_2_pct = select_percents(filter(., displacement_status == "returnee")[["access_healthcare_challenge_reasons"]],
                                                                  2,
                                                                  filter(., displacement_status == "returnee"),
                                                                  questions,
                                                                  choices,
                                                                  "percent",
                                                                  x_name = "access_healthcare_challenge_reasons", group = !!get_group(.)),
            returnee_healthcare_challenge_3_name = select_percents(filter(., displacement_status == "returnee")[["access_healthcare_challenge_reasons"]],
                                                                   3,
                                                                   filter(., displacement_status == "returnee"),
                                                                   questions,
                                                                   choices,
                                                                   "label",
                                                                   x_name = "access_healthcare_challenge_reasons", group = !!get_group(.)),
            returnee_healthcare_challenge_3_pct = select_percents(filter(., displacement_status == "returnee")[["access_healthcare_challenge_reasons"]],
                                                                  3,
                                                                  filter(., displacement_status == "returnee"),
                                                                  questions,
                                                                  choices,
                                                                  "percent",
                                                                  x_name = "access_healthcare_challenge_reasons", group = !!get_group(.)),
            idp_healthcare_challenge_1_name = select_percents(filter(., displacement_status == "idp")[["access_healthcare_challenge_reasons"]],
                                                              1,
                                                              filter(., displacement_status == "idp"),
                                                              questions,
                                                              choices,
                                                              "label",
                                                              x_name = "access_healthcare_challenge_reasons", group = !!get_group(.)),
            idp_healthcare_challenge_1_pct = select_percents(filter(., displacement_status == "idp")[["access_healthcare_challenge_reasons"]],
                                                             1,
                                                             filter(., displacement_status == "idp"),
                                                             questions,
                                                             choices,
                                                             "percent",
                                                             x_name = "access_healthcare_challenge_reasons", group = !!get_group(.)),
            idp_healthcare_challenge_2_name = select_percents(filter(., displacement_status == "idp")[["access_healthcare_challenge_reasons"]],
                                                              2,
                                                              filter(., displacement_status == "idp"),
                                                              questions,
                                                              choices,
                                                              "label",
                                                              x_name = "access_healthcare_challenge_reasons", group = !!get_group(.)),
            idp_healthcare_challenge_2_pct = select_percents(filter(., displacement_status == "idp")[["access_healthcare_challenge_reasons"]],
                                                             2,
                                                             filter(., displacement_status == "idp"),
                                                             questions,
                                                             choices,
                                                             "percent",
                                                             x_name = "access_healthcare_challenge_reasons", group = !!get_group(.)),
            idp_healthcare_challenge_3_name = select_percents(filter(., displacement_status == "idp")[["access_healthcare_challenge_reasons"]],
                                                              3,
                                                              filter(., displacement_status == "idp"),
                                                              questions,
                                                              choices,
                                                              "label",
                                                              x_name = "access_healthcare_challenge_reasons", group = !!get_group(.)),
            idp_healthcare_challenge_3_pct = select_percents(filter(., displacement_status == "idp")[["access_healthcare_challenge_reasons"]],
                                                             3,
                                                             filter(., displacement_status == "idp"),
                                                             questions,
                                                             choices,
                                                             "percent",
                                                             x_name = "access_healthcare_challenge_reasons", group = !!get_group(.)),
            non_displaced_healthcare_challenge_1_name = select_percents(filter(., displacement_status == "non_displaced")[["access_healthcare_challenge_reasons"]],
                                                                        1,
                                                                        filter(., displacement_status == "non_displaced"),
                                                                        questions,
                                                                        choices,
                                                                        "label",
                                                                        x_name = "access_healthcare_challenge_reasons", group = !!get_group(.)),
            non_displaced_healthcare_challenge_1_pct = select_percents(filter(., displacement_status == "non_displaced")[["access_healthcare_challenge_reasons"]],
                                                                       1,
                                                                       filter(., displacement_status == "non_displaced"),
                                                                       questions,
                                                                       choices,
                                                                       "percent",
                                                                       x_name = "access_healthcare_challenge_reasons", group = !!get_group(.)),
            non_displaced_healthcare_challenge_2_name = select_percents(filter(., displacement_status == "non_displaced")[["access_healthcare_challenge_reasons"]],
                                                                        2,
                                                                        filter(., displacement_status == "non_displaced"),
                                                                        questions,
                                                                        choices,
                                                                        "label",
                                                                        x_name = "access_healthcare_challenge_reasons", group = !!get_group(.)),
            non_displaced_healthcare_challenge_2_pct = select_percents(filter(., displacement_status == "non_displaced")[["access_healthcare_challenge_reasons"]],
                                                                       2,
                                                                       filter(., displacement_status == "non_displaced"),
                                                                       questions,
                                                                       choices,
                                                                       "percent",
                                                                       x_name = "access_healthcare_challenge_reasons", group = !!get_group(.)),
            non_displaced_healthcare_challenge_3_name = select_percents(filter(., displacement_status == "non_displaced")[["access_healthcare_challenge_reasons"]],
                                                                        3,
                                                                        filter(., displacement_status == "non_displaced"),
                                                                        questions,
                                                                        choices,
                                                                        "label",
                                                                        x_name = "access_healthcare_challenge_reasons", group = !!get_group(.)),
            non_displaced_healthcare_challenge_3_pct = select_percents(filter(., displacement_status == "non_displaced")[["access_healthcare_challenge_reasons"]],
                                                                       3,
                                                                       filter(., displacement_status == "non_displaced"),
                                                                       questions,
                                                                       choices,
                                                                       "percent",
                                                                       x_name = "access_healthcare_challenge_reasons", group = !!get_group(.)),
            health_time_more_30_min = percent_response(travel_to_healthcare_provider, .,
                                                       "between_30_59min",
                                                       "between_1_2hours",
                                                       "more_2hours", group = !!get_group(.)),
            bottle_fed_child = percent_response(bottle_fed_child, ., "bottle_fed_child", group = !!get_group(.)),
            unable_vaccinate = percent_response(unable_vaccinate, ., "unable_vaccinate", group = !!get_group(.)),
            vaccinate_facility_time_more_30_min = percent_response(time_travel_vaccinations_facility, .,
                                                                   "between_30_59min",
                                                                   "between_1_2hours",
                                                                   "more_2hours", group = !!get_group(.)),
            returnee_chronic_disease = percent_response(filter(., displacement_status == "returnee")[["individual_suffering_chronicdisease"]],
                                                        filter(., displacement_status == "returnee"),
                                                        "yes",
                                                        x_name = "individual_suffering_chronicdisease", group = !!get_group(.)),
            returnee_mental_illness = percent_response(filter(., displacement_status == "returnee")[["individual_suffering_mentaldisorder"]],
                                                       filter(., displacement_status == "returnee"),
                                                       "yes",
                                                       x_name = "individual_suffering_mentaldisorder", group = !!get_group(.)),
            returnee_physical_difficulty = percent_response(filter(., displacement_status == "returnee")[["physical_cognitive_difficulties"]],
                                                            filter(., displacement_status == "returnee"),
                                                            "yes_male_infants", "yes_male_children", "yes_male_youths", "yes_male_adults",
                                                            "yes_male_elderly", "yes_female_infants", "yes_female_children", "yes_female_youths",
                                                            "yes_female_adults", "yes_female_elderly",
                                                            x_name = "physical_cognitive_difficulties", group = !!get_group(.)),
            returnee_behavior_change = percent_response(filter(., displacement_status == "returnee")[["changes_behaviors_minors"]],
                                                        filter(., displacement_status == "returnee"),
                                                        "yes",
                                                        x_name = "changes_behaviors_minors", group = !!get_group(.)),
            idp_chronic_disease = percent_response(filter(., displacement_status == "idp")[["individual_suffering_chronicdisease"]],
                                                   filter(., displacement_status == "idp"),
                                                   "yes",
                                                   x_name = "individual_suffering_chronicdisease", group = !!get_group(.)),
            idp_mental_illness = percent_response(filter(., displacement_status == "idp")[["individual_suffering_mentaldisorder"]],
                                                  filter(., displacement_status == "idp"),
                                                  "yes",
                                                  x_name = "individual_suffering_mentaldisorder", group = !!get_group(.)),
            idp_physical_difficulty = percent_response(filter(., displacement_status == "idp")[["physical_cognitive_difficulties"]],
                                                       filter(., displacement_status == "idp"),
                                                       "yes_male_infants", "yes_male_children", "yes_male_youths", "yes_male_adults",
                                                       "yes_male_elderly", "yes_female_infants", "yes_female_children", "yes_female_youths",
                                                       "yes_female_adults", "yes_female_elderly",
                                                       x_name = "physical_cognitive_difficulties", group = !!get_group(.)),
            idp_behavior_change = percent_response(filter(., displacement_status == "idp")[["changes_behaviors_minors"]],
                                                   filter(., displacement_status == "idp"),
                                                   "yes",
                                                   x_name = "changes_behaviors_minors", group = !!get_group(.)),
            non_displaced_chronic_disease = percent_response(filter(., displacement_status == "non_displaced")[["individual_suffering_chronicdisease"]],
                                                             filter(., displacement_status == "non_displaced"),
                                                             "yes",
                                                             x_name = "individual_suffering_chronicdisease", group = !!get_group(.)),
            non_displaced_mental_illness = percent_response(filter(., displacement_status == "non_displaced")[["individual_suffering_mentaldisorder"]],
                                                            filter(., displacement_status == "non_displaced"),
                                                            "yes",
                                                            x_name = "individual_suffering_mentaldisorder", group = !!get_group(.)),
            non_displaced_physical_difficulty = percent_response(filter(., displacement_status == "non_displaced")[["physical_cognitive_difficulties"]],
                                                                 filter(., displacement_status == "non_displaced"),
                                                                 "yes_male_infants", "yes_male_children", "yes_male_youths", "yes_male_adults",
                                                                 "yes_male_elderly", "yes_female_infants", "yes_female_children", "yes_female_youths",
                                                                 "yes_female_adults", "yes_female_elderly",
                                                                 x_name = "physical_cognitive_difficulties", group = !!get_group(.)),
            non_displaced_behavior_change = percent_response(filter(., displacement_status == "non_displaced")[["changes_behaviors_minors"]],
                                                             filter(., displacement_status == "non_displaced"),
                                                             "yes",
                                                             x_name = "changes_behaviors_minors", group = !!get_group(.)),
            disease_1_name = select_percents(type_chronicdisease, 1, ., questions, choices, "label", group = !!get_group(.)),
            disease_1_pct = select_percents(type_chronicdisease, 1, ., questions, choices, "percent", group = !!get_group(.)),
            disease_2_name = select_percents(type_chronicdisease, 2, ., questions, choices, "label", group = !!get_group(.)),
            disease_2_pct = select_percents(type_chronicdisease, 2, ., questions, choices, "percent", group = !!get_group(.)),
            disease_3_name = select_percents(type_chronicdisease, 3, ., questions, choices, "label", group = !!get_group(.)),
            disease_3_pct = select_percents(type_chronicdisease, 3, ., questions, choices, "percent", group = !!get_group(.)),
            total_assistance = weighted_sum(total_assistance, ., group = !!get_group(.)),
            no_daily_difficulty = round(100 * weighted_sum(no_daily_difficulty, ., group = !!get_group(.)) / total_assistance),
            minor_daily_difficulty = round(100 * weighted_sum(minor_daily_difficulty, ., group = !!get_group(.)) / total_assistance),
            daily_needs_assistance = round(100 * weighted_sum(daily_needs_assistance, ., group = !!get_group(.)) / total_assistance),
            neg_behavior_0_12_num_1_name = select_percents(negative_behaviour_0_12, 1, ., questions, choices, "label", group = !!get_group(.)),
            neg_behavior_0_12_num_1_pct = select_percents(negative_behaviour_0_12, 1, ., questions, choices, "percent", group = !!get_group(.)),
            neg_behavior_0_12_num_2_name = select_percents(negative_behaviour_0_12, 2, ., questions, choices, "label", group = !!get_group(.)),
            neg_behavior_0_12_num_2_pct = select_percents(negative_behaviour_0_12, 2, ., questions, choices, "percent", group = !!get_group(.)),
            neg_behavior_0_12_num_3_name = select_percents(negative_behaviour_0_12, 3, ., questions, choices, "label", group = !!get_group(.)),
            neg_behavior_0_12_num_3_pct = select_percents(negative_behaviour_0_12, 3, ., questions, choices, "percent", group = !!get_group(.)),
            neg_behavior_0_12_num_4_name = select_percents(negative_behaviour_0_12, 4, ., questions, choices, "label", group = !!get_group(.)),
            neg_behavior_0_12_num_4_pct = select_percents(negative_behaviour_0_12, 4, ., questions, choices, "percent", group = !!get_group(.)),
            neg_behavior_0_12_num_5_name = select_percents(negative_behaviour_0_12, 5, ., questions, choices, "label", group = !!get_group(.)),
            neg_behavior_0_12_num_5_pct = select_percents(negative_behaviour_0_12, 5, ., questions, choices, "percent", group = !!get_group(.)),
            neg_behavior_13_17_num_1_name = select_percents(negative_behaviour_13_17, 1, ., questions, choices, "label", group = !!get_group(.)),
            neg_behavior_13_17_num_1_pct = select_percents(negative_behaviour_13_17, 1, ., questions, choices, "percent", group = !!get_group(.)),
            neg_behavior_13_17_num_2_name = select_percents(negative_behaviour_13_17, 2, ., questions, choices, "label", group = !!get_group(.)),
            neg_behavior_13_17_num_2_pct = select_percents(negative_behaviour_13_17, 2, ., questions, choices, "percent", group = !!get_group(.)),
            neg_behavior_13_17_num_3_name = select_percents(negative_behaviour_13_17, 3, ., questions, choices, "label", group = !!get_group(.)),
            neg_behavior_13_17_num_3_pct = select_percents(negative_behaviour_13_17, 3, ., questions, choices, "percent", group = !!get_group(.)),
            neg_behavior_13_17_num_4_name = select_percents(negative_behaviour_13_17, 4, ., questions, choices, "label", group = !!get_group(.)),
            neg_behavior_13_17_num_4_pct = select_percents(negative_behaviour_13_17, 4, ., questions, choices, "percent", group = !!get_group(.)),
            neg_behavior_13_17_num_5_name = select_percents(negative_behaviour_13_17, 5, ., questions, choices, "label", group = !!get_group(.)),
            neg_behavior_13_17_num_5_pct = select_percents(negative_behaviour_13_17, 5, ., questions, choices, "percent", group = !!get_group(.)),
            returnee_child_male = weighted_sum(filter(., displacement_status == "returnee")[["nb_children_male_edu"]],
                                               filter(., displacement_status == "returnee"),
                                               x_name = "nb_children_male_edu", group = !!get_group(.)),
            returnee_enrolled_child_male = weighted_sum(filter(., displacement_status == "returnee")[["enrolled_school_male_6_14_edu"]],
                                                        filter(., displacement_status == "returnee"),
                                                        x_name = "enrolled_school_male_6_14_edu", group = !!get_group(.)),
            returnee_enrolled_child_male_pct = round(100 * returnee_enrolled_child_male / returnee_child_male, 0),
            returnee_attending_child_male = weighted_sum(filter(., displacement_status == "returnee")[["attended_school_male_6_14"]],
                                                         filter(., displacement_status == "returnee"),
                                                         x_name = "attended_school_male_6_14", group = !!get_group(.)),
            returnee_attending_child_male_pct = round(100 * returnee_attending_child_male / returnee_enrolled_child_male, 0),
            returnee_youth_male = weighted_sum(filter(., displacement_status == "returnee")[["nb_youth_male_edu"]],
                                               filter(., displacement_status == "returnee"),
                                               x_name = "nb_youth_male_edu", group = !!get_group(.)),
            returnee_enrolled_youth_male = weighted_sum(filter(., displacement_status == "returnee")[["enrolled_school_male_15_17_edu"]],
                                                        filter(., displacement_status == "returnee"),
                                                        x_name = "enrolled_school_male_15_17_edu", group = !!get_group(.)),
            returnee_enrolled_youth_male_pct = round(100 * returnee_enrolled_youth_male / returnee_youth_male, 0),
            returnee_attending_youth_male = weighted_sum(filter(., displacement_status == "returnee")[["attended_school_male_15_17"]],
                                                         filter(., displacement_status == "returnee"),
                                                         x_name = "attended_school_male_15_17", group = !!get_group(.)),
            returnee_attending_youth_male_pct = round(100 * returnee_attending_youth_male / returnee_enrolled_youth_male, 0),
            returnee_child_female = weighted_sum(filter(., displacement_status == "returnee")[["nb_children_female_edu"]],
                                                 filter(., displacement_status == "returnee"),
                                                 x_name = "nb_children_female_edu", group = !!get_group(.)),
            returnee_enrolled_child_female = weighted_sum(filter(., displacement_status == "returnee")[["enrolled_school_female_6_14_edu"]],
                                                          filter(., displacement_status == "returnee"),
                                                          x_name = "enrolled_school_female_6_14_edu", group = !!get_group(.)),
            returnee_enrolled_child_female_pct = round(100 * returnee_enrolled_child_female / returnee_child_female, 0),
            returnee_attending_child_female = weighted_sum(filter(., displacement_status == "returnee")[["attended_school_female_6_14"]],
                                                           filter(., displacement_status == "returnee"),
                                                           x_name = "attended_school_female_6_14", group = !!get_group(.)),
            returnee_attending_child_female_pct = round(100 * returnee_attending_child_female / returnee_enrolled_child_female, 0),
            returnee_youth_female = weighted_sum(filter(., displacement_status == "returnee")[["nb_youth_female_edu"]],
                                                 filter(., displacement_status == "returnee"),
                                                 x_name = "nb_youth_female_edu", group = !!get_group(.)),
            returnee_enrolled_youth_female = weighted_sum(filter(., displacement_status == "returnee")[["enrolled_school_female_15_17_edu"]],
                                                          filter(., displacement_status == "returnee"),
                                                          x_name = "enrolled_school_female_15_17_edu", group = !!get_group(.)),
            returnee_enrolled_youth_female_pct = round(100 * returnee_enrolled_youth_female / returnee_youth_female, 0),
            returnee_attending_youth_female = weighted_sum(filter(., displacement_status == "returnee")[["attended_school_female_15_17"]],
                                                           filter(., displacement_status == "returnee"),
                                                           x_name = "attended_school_female_15_17", group = !!get_group(.)),
            returnee_attending_youth_female_pct = round(100 * returnee_attending_youth_female / returnee_enrolled_youth_female, 0),
            idp_child_male = weighted_sum(filter(., displacement_status == "idp")[["nb_children_male_edu"]],
                                          filter(., displacement_status == "idp"),
                                          x_name = "nb_children_male_edu", group = !!get_group(.)),
            idp_enrolled_child_male = weighted_sum(filter(., displacement_status == "idp")[["enrolled_school_male_6_14_edu"]],
                                                   filter(., displacement_status == "idp"),
                                                   x_name = "enrolled_school_male_6_14_edu", group = !!get_group(.)),
            idp_enrolled_child_male_pct = round(100 * idp_enrolled_child_male / idp_child_male, 0),
            idp_attending_child_male = weighted_sum(filter(., displacement_status == "idp")[["attended_school_male_6_14"]],
                                                    filter(., displacement_status == "idp"),
                                                    x_name = "attended_school_male_6_14", group = !!get_group(.)),
            idp_attending_child_male_pct = round(100 * idp_attending_child_male / idp_enrolled_child_male, 0),
            idp_youth_male = weighted_sum(filter(., displacement_status == "idp")[["nb_youth_male_edu"]],
                                          filter(., displacement_status == "idp"),
                                          x_name = "nb_youth_male_edu", group = !!get_group(.)),
            idp_enrolled_youth_male = weighted_sum(filter(., displacement_status == "idp")[["enrolled_school_male_15_17_edu"]],
                                                   filter(., displacement_status == "idp"),
                                                   x_name = "enrolled_school_male_15_17_edu", group = !!get_group(.)),
            idp_enrolled_youth_male_pct = round(100 * idp_enrolled_youth_male / idp_youth_male, 0),
            idp_attending_youth_male = weighted_sum(filter(., displacement_status == "idp")[["attended_school_male_15_17"]],
                                                    filter(., displacement_status == "idp"),
                                                    x_name = "attended_school_male_15_17", group = !!get_group(.)),
            idp_attending_youth_male_pct = round(100 * idp_attending_youth_male / idp_enrolled_youth_male, 0),
            idp_child_female = weighted_sum(filter(., displacement_status == "idp")[["nb_children_female_edu"]],
                                            filter(., displacement_status == "idp"),
                                            x_name = "nb_children_female_edu", group = !!get_group(.)),
            idp_enrolled_child_female = weighted_sum(filter(., displacement_status == "idp")[["enrolled_school_female_6_14_edu"]],
                                                     filter(., displacement_status == "idp"),
                                                     x_name = "enrolled_school_female_6_14_edu"),
            idp_enrolled_child_female_pct = round(100 * idp_enrolled_child_female / idp_child_female, 0),
            idp_attending_child_female = weighted_sum(filter(., displacement_status == "idp")[["attended_school_female_6_14"]],
                                                      filter(., displacement_status == "idp"),
                                                      x_name = "attended_school_female_6_14", group = !!get_group(.)),
            idp_attending_child_female_pct = round(100 * idp_attending_child_female / idp_enrolled_child_female, 0),
            idp_youth_female = weighted_sum(filter(., displacement_status == "idp")[["nb_youth_female_edu"]],
                                            filter(., displacement_status == "idp"),
                                            x_name = "nb_youth_female_edu", group = !!get_group(.)),
            idp_enrolled_youth_female = weighted_sum(filter(., displacement_status == "idp")[["enrolled_school_female_15_17_edu"]],
                                                     filter(., displacement_status == "idp"),
                                                     x_name = "enrolled_school_female_15_17_edu", group = !!get_group(.)),
            idp_enrolled_youth_female_pct = round(100 * idp_enrolled_youth_female / idp_youth_female, 0),
            idp_attending_youth_female = weighted_sum(filter(., displacement_status == "idp")[["attended_school_female_15_17"]],
                                                      filter(., displacement_status == "idp"),
                                                      x_name = "attended_school_female_15_17", group = !!get_group(.)),
            idp_attending_youth_female_pct = round(100 * idp_attending_youth_female / idp_enrolled_youth_female, 0),
            non_displaced_child_male = weighted_sum(filter(., displacement_status == "non_displaced")[["nb_children_male_edu"]],
                                                    filter(., displacement_status == "non_displaced"),
                                                    x_name = "nb_children_male_edu", group = !!get_group(.)),
            non_displaced_enrolled_child_male = weighted_sum(filter(., displacement_status == "non_displaced")[["enrolled_school_male_6_14_edu"]],
                                                             filter(., displacement_status == "non_displaced"),
                                                             x_name = "enrolled_school_male_6_14_edu", group = !!get_group(.)),
            non_displaced_enrolled_child_male_pct = round(100 * non_displaced_enrolled_child_male / non_displaced_child_male, 0),
            non_displaced_attending_child_male = weighted_sum(filter(., displacement_status == "non_displaced")[["attended_school_male_6_14"]],
                                                              filter(., displacement_status == "non_displaced"),
                                                              x_name = "attended_school_male_6_14", group = !!get_group(.)),
            non_displaced_attending_child_male_pct = round(100 * non_displaced_attending_child_male / non_displaced_enrolled_child_male, 0),
            non_displaced_youth_male = weighted_sum(filter(., displacement_status == "non_displaced")[["nb_youth_male_edu"]],
                                                    filter(., displacement_status == "non_displaced"),
                                                    x_name = "nb_youth_male_edu", group = !!get_group(.)),
            non_displaced_enrolled_youth_male = weighted_sum(filter(., displacement_status == "non_displaced")[["enrolled_school_male_15_17_edu"]],
                                                             filter(., displacement_status == "non_displaced"),
                                                             x_name = "enrolled_school_male_15_17_edu", group = !!get_group(.)),
            non_displaced_enrolled_youth_male_pct = round(100 * non_displaced_enrolled_youth_male / non_displaced_youth_male, 0),
            non_displaced_attending_youth_male = weighted_sum(filter(., displacement_status == "non_displaced")[["attended_school_male_15_17"]],
                                                              filter(., displacement_status == "non_displaced"),
                                                              x_name = "attended_school_male_15_17", group = !!get_group(.)),
            non_displaced_attending_youth_male_pct = round(100 * non_displaced_attending_youth_male / non_displaced_enrolled_youth_male, 0),
            non_displaced_child_female = weighted_sum(filter(., displacement_status == "non_displaced")[["nb_children_female_edu"]],
                                                      filter(., displacement_status == "non_displaced"),
                                                      x_name = "nb_children_female_edu", group = !!get_group(.)),
            non_displaced_enrolled_child_female = weighted_sum(filter(., displacement_status == "non_displaced")[["enrolled_school_female_6_14_edu"]],
                                                               filter(., displacement_status == "non_displaced"),
                                                               x_name = "enrolled_school_female_6_14_edu", group = !!get_group(.)),
            non_displaced_enrolled_child_female_pct = round(100 * non_displaced_enrolled_child_female / non_displaced_child_female, 0),
            non_displaced_attending_child_female = weighted_sum(filter(., displacement_status == "non_displaced")[["attended_school_female_6_14"]],
                                                                filter(., displacement_status == "non_displaced"),
                                                                x_name = "attended_school_female_6_14", group = !!get_group(.)),
            non_displaced_attending_child_female_pct = round(100 * non_displaced_attending_child_female / non_displaced_enrolled_child_female, 0),
            non_displaced_youth_female = weighted_sum(filter(., displacement_status == "non_displaced")[["nb_youth_female_edu"]],
                                                      filter(., displacement_status == "non_displaced"),
                                                      x_name = "nb_youth_female_edu", group = !!get_group(.)),
            non_displaced_enrolled_youth_female = weighted_sum(filter(., displacement_status == "non_displaced")[["enrolled_school_female_15_17_edu"]],
                                                               filter(., displacement_status == "non_displaced"),
                                                               x_name = "enrolled_school_female_15_17_edu", group = !!get_group(.)),
            non_displaced_enrolled_youth_female_pct = round(100 * non_displaced_enrolled_youth_female / non_displaced_youth_female, 0),
            non_displaced_attending_youth_female = weighted_sum(filter(., displacement_status == "non_displaced")[["attended_school_female_15_17"]],
                                                                filter(., displacement_status == "non_displaced"),
                                                                x_name = "attended_school_female_15_17", group = !!get_group(.)),
            non_displaced_attending_youth_female_pct = round(100 * non_displaced_attending_youth_female / non_displaced_enrolled_youth_female, 0),
            attendance_issue_1_name = select_percents(issues_faced_attending_school, 1, ., questions, choices, "label", group = !!get_group(.)),
            attendance_issue_1_pct = select_percents(issues_faced_attending_school, 1, ., questions, choices, "percent", group = !!get_group(.)),
            attendance_issue_2_name = select_percents(issues_faced_attending_school, 2, ., questions, choices, "label", group = !!get_group(.)),
            attendance_issue_2_pct = select_percents(issues_faced_attending_school, 2, ., questions, choices, "percent", group = !!get_group(.)),
            attendance_issue_3_name = select_percents(issues_faced_attending_school, 3, ., questions, choices, "label", group = !!get_group(.)),
            attendance_issue_3_pct = select_percents(issues_faced_attending_school, 3, ., questions, choices, "percent", group = !!get_group(.)),
            no_attendance_reason_1_name = select_percents(droppedout_school_reasons, 1, ., questions, choices, "label", group = !!get_group(.)),
            no_attendance_reason_1_pct = select_percents(droppedout_school_reasons, 1, ., questions, choices, "percent", group = !!get_group(.)),
            no_attendance_reason_2_name = select_percents(droppedout_school_reasons, 2, ., questions, choices, "label", group = !!get_group(.)),
            no_attendance_reason_2_pct = select_percents(droppedout_school_reasons, 2, ., questions, choices, "percent", group = !!get_group(.)),
            no_attendance_reason_3_name = select_percents(droppedout_school_reasons, 3, ., questions, choices, "label", group = !!get_group(.)),
            no_attendance_reason_3_pct = select_percents(droppedout_school_reasons, 3, ., questions, choices, "percent", group = !!get_group(.)),
            no_attendance_reason_4_name = select_percents(droppedout_school_reasons, 4, ., questions, choices, "label", group = !!get_group(.)),
            no_attendance_reason_4_pct = select_percents(droppedout_school_reasons, 4, ., questions, choices, "percent", group = !!get_group(.)),
            no_attendance_reason_5_name = select_percents(droppedout_school_reasons, 5, ., questions, choices, "label", group = !!get_group(.)),
            no_attendance_reason_5_pct = select_percents(droppedout_school_reasons, 5, ., questions, choices, "percent", group = !!get_group(.)),
            returnee_nonformal_school = percent_response(filter(., displacement_status == "returnee")[["nonformal_education"]],
                                                         filter(., displacement_status == "returnee"),
                                                         "yes_nonformal_classes_byschool",
                                                         x_name = "nonformal_education", group = !!get_group(.)),
            returnee_nonformal_community = percent_response(filter(., displacement_status == "returnee")[["nonformal_education"]],
                                                            filter(., displacement_status == "returnee"),
                                                            "yes_nonformal_classes_bycommunity",
                                                            x_name = "nonformal_education", group = !!get_group(.)),
            returnee_nonformal_priv_bus = percent_response(filter(., displacement_status == "returnee")[["nonformal_education"]],
                                                           filter(., displacement_status == "returnee"),
                                                           "yes_nonformal_privatebusiness",
                                                           x_name = "nonformal_education", group = !!get_group(.)),
            returnee_nonformal_self = percent_response(filter(., displacement_status == "returnee")[["nonformal_education"]],
                                                       filter(., displacement_status == "returnee"),
                                                       "yes_selflearning",
                                                       x_name = "nonformal_education", group = !!get_group(.)),
            returnee_nonformal_ngo = percent_response(filter(., displacement_status == "returnee")[["nonformal_education"]],
                                                      filter(., displacement_status == "returnee"),
                                                      "yes_assistance_ngos",
                                                      x_name = "nonformal_education", group = !!get_group(.)),
            returnee_nonformal_other = percent_response(filter(., displacement_status == "returnee")[["nonformal_education"]],
                                                        filter(., displacement_status == "returnee"),
                                                        "other",
                                                        x_name = "nonformal_education", group = !!get_group(.)),
            returnee_nonformal_total = returnee_nonformal_ngo + returnee_nonformal_community + returnee_nonformal_priv_bus + returnee_nonformal_school + returnee_nonformal_self + returnee_nonformal_other,
            idp_nonformal_school = percent_response(filter(., displacement_status == "idp")[["nonformal_education"]],
                                                    filter(., displacement_status == "idp"),
                                                    "yes_nonformal_classes_byschool",
                                                    x_name = "nonformal_education", group = !!get_group(.)),
            idp_nonformal_community = percent_response(filter(., displacement_status == "idp")[["nonformal_education"]],
                                                       filter(., displacement_status == "idp"),
                                                       "yes_nonformal_classes_bycommunity",
                                                       x_name = "nonformal_education", group = !!get_group(.)),
            idp_nonformal_priv_bus = percent_response(filter(., displacement_status == "idp")[["nonformal_education"]],
                                                      filter(., displacement_status == "idp"),
                                                      "yes_nonformal_privatebusiness",
                                                      x_name = "nonformal_education", group = !!get_group(.)),
            idp_nonformal_self = percent_response(filter(., displacement_status == "idp")[["nonformal_education"]],
                                                  filter(., displacement_status == "idp"),
                                                  "yes_selflearning",
                                                  x_name = "nonformal_education", group = !!get_group(.)),
            idp_nonformal_ngo = percent_response(filter(., displacement_status == "idp")[["nonformal_education"]],
                                                 filter(., displacement_status == "idp"),
                                                 "yes_assistance_ngos",
                                                 x_name = "nonformal_education", group = !!get_group(.)),
            idp_nonformal_other = percent_response(filter(., displacement_status == "idp")[["nonformal_education"]],
                                                   filter(., displacement_status == "idp"),
                                                   "other",
                                                   x_name = "nonformal_education", group = !!get_group(.)),
            idp_nonformal_total = idp_nonformal_ngo + idp_nonformal_community + idp_nonformal_priv_bus + idp_nonformal_school + idp_nonformal_self + idp_nonformal_other,
            non_displaced_nonformal_school = percent_response(filter(., displacement_status == "non_displaced")[["nonformal_education"]],
                                                              filter(., displacement_status == "non_displaced"),
                                                              "yes_nonformal_classes_byschool",
                                                              x_name = "nonformal_education", group = !!get_group(.)),
            non_displaced_nonformal_community = percent_response(filter(., displacement_status == "non_displaced")[["nonformal_education"]],
                                                                 filter(., displacement_status == "non_displaced"),
                                                                 "yes_nonformal_classes_bycommunity",
                                                                 x_name = "nonformal_education", group = !!get_group(.)),
            non_displaced_nonformal_priv_bus = percent_response(filter(., displacement_status == "non_displaced")[["nonformal_education"]],
                                                                filter(., displacement_status == "non_displaced"),
                                                                "yes_nonformal_privatebusiness",
                                                                x_name = "nonformal_education", group = !!get_group(.)),
            non_displaced_nonformal_self = percent_response(filter(., displacement_status == "non_displaced")[["nonformal_education"]],
                                                            filter(., displacement_status == "non_displaced"),
                                                            "yes_selflearning",
                                                            x_name = "nonformal_education", group = !!get_group(.)),
            non_displaced_nonformal_ngo = percent_response(filter(., displacement_status == "non_displaced")[["nonformal_education"]],
                                                           filter(., displacement_status == "non_displaced"),
                                                           "yes_assistance_ngos",
                                                           x_name = "nonformal_education", group = !!get_group(.)),
            non_displaced_nonformal_other = percent_response(filter(., displacement_status == "non_displaced")[["nonformal_education"]],
                                                             filter(., displacement_status == "non_displaced"),
                                                             "other",
                                                             x_name = "nonformal_education", group = !!get_group(.)),
            non_displaced_nonformal_total = non_displaced_nonformal_ngo + non_displaced_nonformal_community + non_displaced_nonformal_priv_bus + non_displaced_nonformal_school + non_displaced_nonformal_self + non_displaced_nonformal_other,
            returnee_document_need_1_name = select_percents(filter(., displacement_status == "returnee")[["document_needs"]],
                                                            1,
                                                            filter(., displacement_status == "returnee"),
                                                            questions,
                                                            choices,
                                                            "label",
                                                            x_name = "document_needs", group = !!get_group(.)),
            returnee_document_need_1_pct = select_percents(filter(., displacement_status == "returnee")[["document_needs"]],
                                                           1,
                                                           filter(., displacement_status == "returnee"),
                                                           questions,
                                                           choices,
                                                           "percent",
                                                           x_name = "document_needs", group = !!get_group(.)),
            returnee_document_need_2_name = select_percents(filter(., displacement_status == "returnee")[["document_needs"]],
                                                            2,
                                                            filter(., displacement_status == "returnee"),
                                                            questions,
                                                            choices,
                                                            "label",
                                                            x_name = "document_needs", group = !!get_group(.)),
            returnee_document_need_2_pct = select_percents(filter(., displacement_status == "returnee")[["document_needs"]],
                                                           2,
                                                           filter(., displacement_status == "returnee"),
                                                           questions,
                                                           choices,
                                                           "percent",
                                                           x_name = "document_needs", group = !!get_group(.)),
            returnee_document_need_3_name = select_percents(filter(., displacement_status == "returnee")[["document_needs"]],
                                                            3,
                                                            filter(., displacement_status == "returnee"),
                                                            questions,
                                                            choices,
                                                            "label",
                                                            x_name = "document_needs", group = !!get_group(.)),
            returnee_document_need_3_pct = select_percents(filter(., displacement_status == "returnee")[["document_needs"]],
                                                           3,
                                                           filter(., displacement_status == "returnee"),
                                                           questions,
                                                           choices,
                                                           "percent",
                                                           x_name = "document_needs", group = !!get_group(.)),
            idp_document_need_1_name = select_percents(filter(., displacement_status == "idp")[["document_needs"]],
                                                       1,
                                                       filter(., displacement_status == "idp"),
                                                       questions,
                                                       choices,
                                                       "label",
                                                       x_name = "document_needs", group = !!get_group(.)),
            idp_document_need_1_pct = select_percents(filter(., displacement_status == "idp")[["document_needs"]],
                                                      1,
                                                      filter(., displacement_status == "idp"),
                                                      questions,
                                                      choices,
                                                      "percent",
                                                      x_name = "document_needs", group = !!get_group(.)),
            idp_document_need_2_name = select_percents(filter(., displacement_status == "idp")[["document_needs"]],
                                                       2,
                                                       filter(., displacement_status == "idp"),
                                                       questions,
                                                       choices,
                                                       "label",
                                                       x_name = "document_needs", group = !!get_group(.)),
            idp_document_need_2_pct = select_percents(filter(., displacement_status == "idp")[["document_needs"]],
                                                      2,
                                                      filter(., displacement_status == "idp"),
                                                      questions,
                                                      choices,
                                                      "percent",
                                                      x_name = "document_needs", group = !!get_group(.)),
            idp_document_need_3_name = select_percents(filter(., displacement_status == "idp")[["document_needs"]],
                                                       3,
                                                       filter(., displacement_status == "idp"),
                                                       questions,
                                                       choices,
                                                       "label",
                                                       x_name = "document_needs", group = !!get_group(.)),
            idp_document_need_3_pct = select_percents(filter(., displacement_status == "idp")[["document_needs"]],
                                                      3,
                                                      filter(., displacement_status == "idp"),
                                                      questions,
                                                      choices,
                                                      "percent",
                                                      x_name = "document_needs", group = !!get_group(.)),
            non_displaced_document_need_1_name = select_percents(filter(., displacement_status == "non_displaced")[["document_needs"]],
                                                                 1,
                                                                 filter(., displacement_status == "non_displaced"),
                                                                 questions,
                                                                 choices,
                                                                 "label",
                                                                 x_name = "document_needs", group = !!get_group(.)),
            non_displaced_document_need_1_pct = select_percents(filter(., displacement_status == "non_displaced")[["document_needs"]],
                                                                1,
                                                                filter(., displacement_status == "non_displaced"),
                                                                questions,
                                                                choices,
                                                                "percent",
                                                                x_name = "document_needs", group = !!get_group(.)),
            non_displaced_document_need_2_name = select_percents(filter(., displacement_status == "non_displaced")[["document_needs"]],
                                                                 2,
                                                                 filter(., displacement_status == "non_displaced"),
                                                                 questions,
                                                                 choices,
                                                                 "label",
                                                                 x_name = "document_needs", group = !!get_group(.)),
            non_displaced_document_need_2_pct = select_percents(filter(., displacement_status == "non_displaced")[["document_needs"]],
                                                                2,
                                                                filter(., displacement_status == "non_displaced"),
                                                                questions,
                                                                choices,
                                                                "percent",
                                                                x_name = "document_needs", group = !!get_group(.)),
            non_displaced_document_need_3_name = select_percents(filter(., displacement_status == "non_displaced")[["document_needs"]],
                                                                 3,
                                                                 filter(., displacement_status == "non_displaced"),
                                                                 questions,
                                                                 choices,
                                                                 "label",
                                                                 x_name = "document_needs", group = !!get_group(.)),
            non_displaced_document_need_3_pct = select_percents(filter(., displacement_status == "non_displaced")[["document_needs"]],
                                                                3,
                                                                filter(., displacement_status == "non_displaced"),
                                                                questions,
                                                                choices,
                                                                "percent",
                                                                x_name = "document_needs", group = !!get_group(.)),
            returnee_doc_loss_impact_1_name = select_percents(filter(., displacement_status == "returnee")[["losing_legal_docs_impact"]],
                                                              1,
                                                              filter(., displacement_status == "returnee"),
                                                              questions,
                                                              choices,
                                                              "label",
                                                              x_name = "losing_legal_docs_impact", group = !!get_group(.)),
            returnee_doc_loss_impact_1_pct = select_percents(filter(., displacement_status == "returnee")[["losing_legal_docs_impact"]],
                                                             1,
                                                             filter(., displacement_status == "returnee"),
                                                             questions,
                                                             choices,
                                                             "percent",
                                                             x_name = "losing_legal_docs_impact", group = !!get_group(.)),
            returnee_doc_loss_impact_2_name = select_percents(filter(., displacement_status == "returnee")[["losing_legal_docs_impact"]],
                                                              2,
                                                              filter(., displacement_status == "returnee"),
                                                              questions,
                                                              choices,
                                                              "label",
                                                              x_name = "losing_legal_docs_impact", group = !!get_group(.)),
            returnee_doc_loss_impact_2_pct = select_percents(filter(., displacement_status == "returnee")[["losing_legal_docs_impact"]],
                                                             2,
                                                             filter(., displacement_status == "returnee"),
                                                             questions,
                                                             choices,
                                                             "percent",
                                                             x_name = "losing_legal_docs_impact", group = !!get_group(.)),
            returnee_doc_loss_impact_3_name = select_percents(filter(., displacement_status == "returnee")[["losing_legal_docs_impact"]],
                                                              3,
                                                              filter(., displacement_status == "returnee"),
                                                              questions,
                                                              choices,
                                                              "label",
                                                              x_name = "losing_legal_docs_impact", group = !!get_group(.)),
            returnee_doc_loss_impact_3_pct = select_percents(filter(., displacement_status == "returnee")[["losing_legal_docs_impact"]],
                                                             3,
                                                             filter(., displacement_status == "returnee"),
                                                             questions,
                                                             choices,
                                                             "percent",
                                                             x_name = "losing_legal_docs_impact", group = !!get_group(.)),
            idp_doc_loss_impact_1_name = select_percents(filter(., displacement_status == "idp")[["losing_legal_docs_impact"]],
                                                         1,
                                                         filter(., displacement_status == "idp"),
                                                         questions,
                                                         choices,
                                                         "label",
                                                         x_name = "losing_legal_docs_impact", group = !!get_group(.)),
            idp_doc_loss_impact_1_pct = select_percents(filter(., displacement_status == "idp")[["losing_legal_docs_impact"]],
                                                        1,
                                                        filter(., displacement_status == "idp"),
                                                        questions,
                                                        choices,
                                                        "percent",
                                                        x_name = "losing_legal_docs_impact", group = !!get_group(.)),
            idp_doc_loss_impact_2_name = select_percents(filter(., displacement_status == "idp")[["losing_legal_docs_impact"]],
                                                         2,
                                                         filter(., displacement_status == "idp"),
                                                         questions,
                                                         choices,
                                                         "label",
                                                         x_name = "losing_legal_docs_impact", group = !!get_group(.)),
            idp_doc_loss_impact_2_pct = select_percents(filter(., displacement_status == "idp")[["losing_legal_docs_impact"]],
                                                        2,
                                                        filter(., displacement_status == "idp"),
                                                        questions,
                                                        choices,
                                                        "percent",
                                                        x_name = "losing_legal_docs_impact", group = !!get_group(.)),
            idp_doc_loss_impact_3_name = select_percents(filter(., displacement_status == "idp")[["losing_legal_docs_impact"]],
                                                         3,
                                                         filter(., displacement_status == "idp"),
                                                         questions,
                                                         choices,
                                                         "label",
                                                         x_name = "losing_legal_docs_impact", group = !!get_group(.)),
            idp_doc_loss_impact_3_pct = select_percents(filter(., displacement_status == "idp")[["losing_legal_docs_impact"]],
                                                        3,
                                                        filter(., displacement_status == "idp"),
                                                        questions,
                                                        choices,
                                                        "percent",
                                                        x_name = "losing_legal_docs_impact", group = !!get_group(.)),
            non_displaced_doc_loss_impact_1_name = select_percents(filter(., displacement_status == "non_displaced")[["losing_legal_docs_impact"]],
                                                                   1,
                                                                   filter(., displacement_status == "non_displaced"),
                                                                   questions,
                                                                   choices,
                                                                   "label",
                                                                   x_name = "losing_legal_docs_impact", group = !!get_group(.)),
            non_displaced_doc_loss_impact_1_pct = select_percents(filter(., displacement_status == "non_displaced")[["losing_legal_docs_impact"]],
                                                                  1,
                                                                  filter(., displacement_status == "non_displaced"),
                                                                  questions,
                                                                  choices,
                                                                  "percent",
                                                                  x_name = "losing_legal_docs_impact", group = !!get_group(.)),
            non_displaced_doc_loss_impact_2_name = select_percents(filter(., displacement_status == "non_displaced")[["losing_legal_docs_impact"]],
                                                                   2,
                                                                   filter(., displacement_status == "non_displaced"),
                                                                   questions,
                                                                   choices,
                                                                   "label",
                                                                   x_name = "losing_legal_docs_impact", group = !!get_group(.)),
            non_displaced_doc_loss_impact_2_pct = select_percents(filter(., displacement_status == "non_displaced")[["losing_legal_docs_impact"]],
                                                                  2,
                                                                  filter(., displacement_status == "non_displaced"),
                                                                  questions,
                                                                  choices,
                                                                  "percent",
                                                                  x_name = "losing_legal_docs_impact", group = !!get_group(.)),
            non_displaced_doc_loss_impact_3_name = select_percents(filter(., displacement_status == "non_displaced")[["losing_legal_docs_impact"]],
                                                                   3,
                                                                   filter(., displacement_status == "non_displaced"),
                                                                   questions,
                                                                   choices,
                                                                   "label",
                                                                   x_name = "losing_legal_docs_impact", group = !!get_group(.)),
            non_displaced_doc_loss_impact_3_pct = select_percents(filter(., displacement_status == "non_displaced")[["losing_legal_docs_impact"]],
                                                                  3,
                                                                  filter(., displacement_status == "non_displaced"),
                                                                  questions,
                                                                  choices,
                                                                  "percent",
                                                                  x_name = "losing_legal_docs_impact", group = !!get_group(.)),
            aware_explosives = percent_response(presence_explosive_hazards, ., "yes", group = !!get_group(.)),
            explosive_action_1_name = select_percents(presence_explosive_hazards_actions, 1, ., questions, choices, "label", group = !!get_group(.)),
            explosive_action_1_pct = select_percents(presence_explosive_hazards_actions, 1, ., questions, choices, "percent", group = !!get_group(.)),
            explosive_action_2_name = select_percents(presence_explosive_hazards_actions, 2, ., questions, choices, "label", group = !!get_group(.)),
            explosive_action_2_pct = select_percents(presence_explosive_hazards_actions, 2, ., questions, choices, "percent", group = !!get_group(.)),
            explosive_action_3_name = select_percents(presence_explosive_hazards_actions, 3, ., questions, choices, "label", group = !!get_group(.)),
            explosive_action_3_pct = select_percents(presence_explosive_hazards_actions, 3, ., questions, choices, "percent", group = !!get_group(.)),
            explosive_action_3_other_pct = 100 - explosive_action_1_pct - explosive_action_2_pct - explosive_action_3_pct,
            no_explosive_awareness = percent_response(explosive_hazards_risk_awareness, ., "no", group = !!get_group(.)),
            member_killed_injured = percent_response(explosive_hazards_injured, .,
                                                     "yes_adult_injured",
                                                     "yes_adult_killes",
                                                     "yes_children_injured",
                                                     "yes_children_killed", group = !!get_group(.)),
            missing_members = percent_response(missing_family_members, ., "yes", group = !!get_group(.)),
            movement_restrictions = percent_response(movement_restrictions, ., "yes", group = !!get_group(.)),
            returnee_priority_need_1_name = select_percents(filter(., displacement_status == "returnee")[["priority_needs"]],
                                                            1,
                                                            filter(., displacement_status == "returnee"),
                                                            questions,
                                                            choices,
                                                            "label",
                                                            x_name = "priority_needs", group = !!get_group(.)),
            returnee_priority_need_1_pct = select_percents(filter(., displacement_status == "returnee")[["priority_needs"]],
                                                           2,
                                                           filter(., displacement_status == "returnee"),
                                                           questions,
                                                           choices,
                                                           "percent",
                                                           x_name = "priority_needs", group = !!get_group(.)),
            returnee_priority_need_2_name = select_percents(filter(., displacement_status == "returnee")[["priority_needs"]],
                                                            1,
                                                            filter(., displacement_status == "returnee"),
                                                            questions,
                                                            choices,
                                                            "label",
                                                            x_name = "priority_needs", group = !!get_group(.)),
            returnee_priority_need_2_pct = select_percents(filter(., displacement_status == "returnee")[["priority_needs"]],
                                                           2,
                                                           filter(., displacement_status == "returnee"),
                                                           questions,
                                                           choices,
                                                           "percent",
                                                           x_name = "priority_needs", group = !!get_group(.)),
            returnee_priority_need_3_name = select_percents(filter(., displacement_status == "returnee")[["priority_needs"]],
                                                            3,
                                                            filter(., displacement_status == "returnee"),
                                                            questions,
                                                            choices,
                                                            "label",
                                                            x_name = "priority_needs", group = !!get_group(.)),
            returnee_priority_need_3_pct = select_percents(filter(., displacement_status == "returnee")[["priority_needs"]],
                                                           3,
                                                           filter(., displacement_status == "returnee"),
                                                           questions,
                                                           choices,
                                                           "percent",
                                                           x_name = "priority_needs", group = !!get_group(.)),
            idp_priority_need_1_name = select_percents(filter(., displacement_status == "idp")[["priority_needs"]],
                                                       1,
                                                       filter(., displacement_status == "idp"),
                                                       questions,
                                                       choices,
                                                       "label",
                                                       x_name = "priority_needs", group = !!get_group(.)),
            idp_priority_need_1_pct = select_percents(filter(., displacement_status == "idp")[["priority_needs"]],
                                                      2,
                                                      filter(., displacement_status == "idp"),
                                                      questions,
                                                      choices,
                                                      "percent",
                                                      x_name = "priority_needs", group = !!get_group(.)),
            idp_priority_need_2_name = select_percents(filter(., displacement_status == "idp")[["priority_needs"]],
                                                       1,
                                                       filter(., displacement_status == "idp"),
                                                       questions,
                                                       choices,
                                                       "label",
                                                       x_name = "priority_needs", group = !!get_group(.)),
            idp_priority_need_2_pct = select_percents(filter(., displacement_status == "idp")[["priority_needs"]],
                                                      2,
                                                      filter(., displacement_status == "idp"),
                                                      questions,
                                                      choices,
                                                      "percent",
                                                      x_name = "priority_needs", group = !!get_group(.)),
            idp_priority_need_3_name = select_percents(filter(., displacement_status == "idp")[["priority_needs"]],
                                                       3,
                                                       filter(., displacement_status == "idp"),
                                                       questions,
                                                       choices,
                                                       "label",
                                                       x_name = "priority_needs", group = !!get_group(.)),
            idp_priority_need_3_pct = select_percents(filter(., displacement_status == "idp")[["priority_needs"]],
                                                      3,
                                                      filter(., displacement_status == "idp"),
                                                      questions,
                                                      choices,
                                                      "percent",
                                                      x_name = "priority_needs", group = !!get_group(.)),
            non_displaced_priority_need_1_name = select_percents(filter(., displacement_status == "non_displaced")[["priority_needs"]],
                                                                 1,
                                                                 filter(., displacement_status == "non_displaced"),
                                                                 questions,
                                                                 choices,
                                                                 "label",
                                                                 x_name = "priority_needs", group = !!get_group(.)),
            non_displaced_priority_need_1_pct = select_percents(filter(., displacement_status == "non_displaced")[["priority_needs"]],
                                                                2,
                                                                filter(., displacement_status == "non_displaced"),
                                                                questions,
                                                                choices,
                                                                "percent",
                                                                x_name = "priority_needs", group = !!get_group(.)),
            non_displaced_priority_need_2_name = select_percents(filter(., displacement_status == "non_displaced")[["priority_needs"]],
                                                                 1,
                                                                 filter(., displacement_status == "non_displaced"),
                                                                 questions,
                                                                 choices,
                                                                 "label",
                                                                 x_name = "priority_needs", group = !!get_group(.)),
            non_displaced_priority_need_2_pct = select_percents(filter(., displacement_status == "non_displaced")[["priority_needs"]],
                                                                2,
                                                                filter(., displacement_status == "non_displaced"),
                                                                questions,
                                                                choices,
                                                                "percent",
                                                                x_name = "priority_needs", group = !!get_group(.)),
            non_displaced_priority_need_3_name = select_percents(filter(., displacement_status == "non_displaced")[["priority_needs"]],
                                                                 3,
                                                                 filter(., displacement_status == "non_displaced"),
                                                                 questions,
                                                                 choices,
                                                                 "label",
                                                                 x_name = "priority_needs", group = !!get_group(.)),
            non_displaced_priority_need_3_pct = select_percents(filter(., displacement_status == "non_displaced")[["priority_needs"]],
                                                                3,
                                                                filter(., displacement_status == "non_displaced"),
                                                                questions,
                                                                choices,
                                                                "percent",
                                                                x_name = "priority_needs", group = !!get_group(.)),
            received_assistance = percent_response(received_humanitarian_assistance, ., "yes", group = !!get_group(.)),
            rec_ass_type_1_name = select_percents(modality_assistance_received, 1, ., questions, choices, "label", group = !!get_group(.)),
            rec_ass_type_1_pct = select_percents(modality_assistance_received, 1, ., questions, choices, "percent", group = !!get_group(.)),
            rec_ass_type_2_name = select_percents(modality_assistance_received, 2, ., questions, choices, "label", group = !!get_group(.)),
            rec_ass_type_2_pct = select_percents(modality_assistance_received, 2, ., questions, choices, "percent", group = !!get_group(.)),
            rec_ass_type_3_name = select_percents(modality_assistance_received, 3, ., questions, choices, "label", group = !!get_group(.)),
            rec_ass_type_3_pct = select_percents(modality_assistance_received, 3, ., questions, choices, "percent", group = !!get_group(.)),
            rec_ass_type_4_name = select_percents(modality_assistance_received, 4, ., questions, choices, "label", group = !!get_group(.)),
            rec_ass_type_4_pct = select_percents(modality_assistance_received, 4, ., questions, choices, "percent", group = !!get_group(.)),
            rec_ass_type_5_name = select_percents(modality_assistance_received, 5, ., questions, choices, "label", group = !!get_group(.)),
            rec_ass_type_5_pct = select_percents(modality_assistance_received, 5, ., questions, choices, "percent", group = !!get_group(.)),
            assistance_satisfied = percent_response(humanitarian_assistance_satisfaction, ., "yes", group = !!get_group(.)),
            returnee_ass_barrier_1_name = select_percents(filter(., displacement_status == "returnee")[["humanitarian_assistance_barriers"]],
                                                          1,
                                                          filter(., displacement_status == "returnee"),
                                                          questions,
                                                          choices,
                                                          "label",
                                                          x_name = "humanitarian_assistance_barriers", group = !!get_group(.)),
            returnee_ass_barrier_1_pct = select_percents(filter(., displacement_status == "returnee")[["humanitarian_assistance_barriers"]],
                                                         1,
                                                         filter(., displacement_status == "returnee"),
                                                         questions,
                                                         choices,
                                                         "percent",
                                                         x_name = "humanitarian_assistance_barriers", group = !!get_group(.)),
            returnee_ass_barrier_2_name = select_percents(filter(., displacement_status == "returnee")[["humanitarian_assistance_barriers"]],
                                                          2,
                                                          filter(., displacement_status == "returnee"),
                                                          questions,
                                                          choices,
                                                          "label",
                                                          x_name = "humanitarian_assistance_barriers", group = !!get_group(.)),
            returnee_ass_barrier_2_pct = select_percents(filter(., displacement_status == "returnee")[["humanitarian_assistance_barriers"]],
                                                         2,
                                                         filter(., displacement_status == "returnee"),
                                                         questions,
                                                         choices,
                                                         "percent",
                                                         x_name = "humanitarian_assistance_barriers", group = !!get_group(.)),
            returnee_ass_barrier_3_name = select_percents(filter(., displacement_status == "returnee")[["humanitarian_assistance_barriers"]],
                                                          3,
                                                          filter(., displacement_status == "returnee"),
                                                          questions,
                                                          choices,
                                                          "label",
                                                          x_name = "humanitarian_assistance_barriers", group = !!get_group(.)),
            returnee_ass_barrier_3_pct = select_percents(filter(., displacement_status == "returnee")[["humanitarian_assistance_barriers"]],
                                                         3,
                                                         filter(., displacement_status == "returnee"),
                                                         questions,
                                                         choices,
                                                         "percent",
                                                         x_name = "humanitarian_assistance_barriers", group = !!get_group(.)),
            idp_ass_barrier_1_name = select_percents(filter(., displacement_status == "idp")[["humanitarian_assistance_barriers"]],
                                                     1,
                                                     filter(., displacement_status == "idp"),
                                                     questions,
                                                     choices,
                                                     "label",
                                                     x_name = "humanitarian_assistance_barriers", group = !!get_group(.)),
            idp_ass_barrier_1_pct = select_percents(filter(., displacement_status == "idp")[["humanitarian_assistance_barriers"]],
                                                    1,
                                                    filter(., displacement_status == "idp"),
                                                    questions,
                                                    choices,
                                                    "percent",
                                                    x_name = "humanitarian_assistance_barriers", group = !!get_group(.)),
            idp_ass_barrier_2_name = select_percents(filter(., displacement_status == "idp")[["humanitarian_assistance_barriers"]],
                                                     2,
                                                     filter(., displacement_status == "idp"),
                                                     questions,
                                                     choices,
                                                     "label",
                                                     x_name = "humanitarian_assistance_barriers", group = !!get_group(.)),
            idp_ass_barrier_2_pct = select_percents(filter(., displacement_status == "idp")[["humanitarian_assistance_barriers"]],
                                                    2,
                                                    filter(., displacement_status == "idp"),
                                                    questions,
                                                    choices,
                                                    "percent",
                                                    x_name = "humanitarian_assistance_barriers", group = !!get_group(.)),
            idp_ass_barrier_3_name = select_percents(filter(., displacement_status == "idp")[["humanitarian_assistance_barriers"]],
                                                     3,
                                                     filter(., displacement_status == "idp"),
                                                     questions,
                                                     choices,
                                                     "label",
                                                     x_name = "humanitarian_assistance_barriers", group = !!get_group(.)),
            idp_ass_barrier_3_pct = select_percents(filter(., displacement_status == "idp")[["humanitarian_assistance_barriers"]],
                                                    3,
                                                    filter(., displacement_status == "idp"),
                                                    questions,
                                                    choices,
                                                    "percent",
                                                    x_name = "humanitarian_assistance_barriers", group = !!get_group(.)),
            non_displaced_ass_barrier_1_name = select_percents(filter(., displacement_status == "non_displaced")[["humanitarian_assistance_barriers"]],
                                                               1,
                                                               filter(., displacement_status == "non_displaced"),
                                                               questions,
                                                               choices,
                                                               "label",
                                                               x_name = "humanitarian_assistance_barriers", group = !!get_group(.)),
            non_displaced_ass_barrier_1_pct = select_percents(filter(., displacement_status == "non_displaced")[["humanitarian_assistance_barriers"]],
                                                              1,
                                                              filter(., displacement_status == "non_displaced"),
                                                              questions,
                                                              choices,
                                                              "percent",
                                                              x_name = "humanitarian_assistance_barriers", group = !!get_group(.)),
            non_displaced_ass_barrier_2_name = select_percents(filter(., displacement_status == "non_displaced")[["humanitarian_assistance_barriers"]],
                                                               2,
                                                               filter(., displacement_status == "non_displaced"),
                                                               questions,
                                                               choices,
                                                               "label",
                                                               x_name = "humanitarian_assistance_barriers", group = !!get_group(.)),
            non_displaced_ass_barrier_2_pct = select_percents(filter(., displacement_status == "non_displaced")[["humanitarian_assistance_barriers"]],
                                                              2,
                                                              filter(., displacement_status == "non_displaced"),
                                                              questions,
                                                              choices,
                                                              "percent",
                                                              x_name = "humanitarian_assistance_barriers", group = !!get_group(.)),
            non_displaced_ass_barrier_3_name = select_percents(filter(., displacement_status == "non_displaced")[["humanitarian_assistance_barriers"]],
                                                               3,
                                                               filter(., displacement_status == "non_displaced"),
                                                               questions,
                                                               choices,
                                                               "label",
                                                               x_name = "humanitarian_assistance_barriers", group = !!get_group(.)),
            non_displaced_ass_barrier_3_pct = select_percents(filter(., displacement_status == "non_displaced")[["humanitarian_assistance_barriers"]],
                                                              3,
                                                              filter(., displacement_status == "non_displaced"),
                                                              questions,
                                                              choices,
                                                              "percent",
                                                              x_name = "humanitarian_assistance_barriers", group = !!get_group(.)),
            returnee_prefer_ass_1_name = select_percents(filter(., displacement_status == "returnee")[["preferred_assistance_modality"]],
                                                         1,
                                                         filter(., displacement_status == "returnee"),
                                                         questions,
                                                         choices,
                                                         "label",
                                                         x_name = "preferred_assistance_modality", group = !!get_group(.)),
            returnee_prefer_ass_1_pct = select_percents(filter(., displacement_status == "returnee")[["preferred_assistance_modality"]],
                                                        1,
                                                        filter(., displacement_status == "returnee"),
                                                        questions,
                                                        choices,
                                                        "percent",
                                                        x_name = "preferred_assistance_modality", group = !!get_group(.)),
            returnee_prefer_ass_2_name = select_percents(filter(., displacement_status == "returnee")[["preferred_assistance_modality"]],
                                                         2,
                                                         filter(., displacement_status == "returnee"),
                                                         questions,
                                                         choices,
                                                         "label",
                                                         x_name = "preferred_assistance_modality", group = !!get_group(.)),
            returnee_prefer_ass_2_pct = select_percents(filter(., displacement_status == "returnee")[["preferred_assistance_modality"]],
                                                        2,
                                                        filter(., displacement_status == "returnee"),
                                                        questions,
                                                        choices,
                                                        "percent",
                                                        x_name = "preferred_assistance_modality", group = !!get_group(.)),
            returnee_prefer_ass_3_name = select_percents(filter(., displacement_status == "returnee")[["preferred_assistance_modality"]],
                                                         3,
                                                         filter(., displacement_status == "returnee"),
                                                         questions,
                                                         choices,
                                                         "label",
                                                         x_name = "preferred_assistance_modality", group = !!get_group(.)),
            returnee_prefer_ass_3_pct = select_percents(filter(., displacement_status == "returnee")[["preferred_assistance_modality"]],
                                                        3,
                                                        filter(., displacement_status == "returnee"),
                                                        questions,
                                                        choices,
                                                        "percent",
                                                        x_name = "preferred_assistance_modality", group = !!get_group(.)),
            idp_prefer_ass_1_name = select_percents(filter(., displacement_status == "idp")[["preferred_assistance_modality"]],
                                                    1,
                                                    filter(., displacement_status == "idp"),
                                                    questions,
                                                    choices,
                                                    "label",
                                                    x_name = "preferred_assistance_modality", group = !!get_group(.)),
            idp_prefer_ass_1_pct = select_percents(filter(., displacement_status == "idp")[["preferred_assistance_modality"]],
                                                   1,
                                                   filter(., displacement_status == "idp"),
                                                   questions,
                                                   choices,
                                                   "percent",
                                                   x_name = "preferred_assistance_modality", group = !!get_group(.)),
            idp_prefer_ass_2_name = select_percents(filter(., displacement_status == "idp")[["preferred_assistance_modality"]],
                                                    2,
                                                    filter(., displacement_status == "idp"),
                                                    questions,
                                                    choices,
                                                    "label",
                                                    x_name = "preferred_assistance_modality", group = !!get_group(.)),
            idp_prefer_ass_2_pct = select_percents(filter(., displacement_status == "idp")[["preferred_assistance_modality"]],
                                                   2,
                                                   filter(., displacement_status == "idp"),
                                                   questions,
                                                   choices,
                                                   "percent",
                                                   x_name = "preferred_assistance_modality", group = !!get_group(.)),
            idp_prefer_ass_3_name = select_percents(filter(., displacement_status == "idp")[["preferred_assistance_modality"]],
                                                    3,
                                                    filter(., displacement_status == "idp"),
                                                    questions,
                                                    choices,
                                                    "label",
                                                    x_name = "preferred_assistance_modality", group = !!get_group(.)),
            idp_prefer_ass_3_pct = select_percents(filter(., displacement_status == "idp")[["preferred_assistance_modality"]],
                                                   3,
                                                   filter(., displacement_status == "idp"),
                                                   questions,
                                                   choices,
                                                   "percent",
                                                   x_name = "preferred_assistance_modality", group = !!get_group(.)),
            non_displaced_prefer_ass_1_name = select_percents(filter(., displacement_status == "non_displaced")[["preferred_assistance_modality"]],
                                                              1,
                                                              filter(., displacement_status == "non_displaced"),
                                                              questions,
                                                              choices,
                                                              "label",
                                                              x_name = "preferred_assistance_modality", group = !!get_group(.)),
            non_displaced_prefer_ass_1_pct = select_percents(filter(., displacement_status == "non_displaced")[["preferred_assistance_modality"]],
                                                             1,
                                                             filter(., displacement_status == "non_displaced"),
                                                             questions,
                                                             choices,
                                                             "percent",
                                                             x_name = "preferred_assistance_modality", group = !!get_group(.)),
            non_displaced_prefer_ass_2_name = select_percents(filter(., displacement_status == "non_displaced")[["preferred_assistance_modality"]],
                                                              2,
                                                              filter(., displacement_status == "non_displaced"),
                                                              questions,
                                                              choices,
                                                              "label",
                                                              x_name = "preferred_assistance_modality", group = !!get_group(.)),
            non_displaced_prefer_ass_2_pct = select_percents(filter(., displacement_status == "non_displaced")[["preferred_assistance_modality"]],
                                                             2,
                                                             filter(., displacement_status == "non_displaced"),
                                                             questions,
                                                             choices,
                                                             "percent",
                                                             x_name = "preferred_assistance_modality", group = !!get_group(.)),
            non_displaced_prefer_ass_3_name = select_percents(filter(., displacement_status == "non_displaced")[["preferred_assistance_modality"]],
                                                              3,
                                                              filter(., displacement_status == "non_displaced"),
                                                              questions,
                                                              choices,
                                                              "label",
                                                              x_name = "preferred_assistance_modality", group = !!get_group(.)),
            non_displaced_prefer_ass_3_pct = select_percents(filter(., displacement_status == "non_displaced")[["preferred_assistance_modality"]],
                                                             3,
                                                             filter(., displacement_status == "non_displaced"),
                                                             questions,
                                                             choices,
                                                             "percent",
                                                             x_name = "preferred_assistance_modality", group = !!get_group(.))) %>%
  mutate(returnee_adult_perm_job = round(100 * returnee_adult_perm_job / returnee_adults, 1),
         returnee_adult_temp_job = round(100 * returnee_adult_temp_job / returnee_adults, 1),
         returnee_adult_daily_labour = round(100 * returnee_adult_daily_labour / returnee_adults, 1),
         returnee_adult_gvt_payroll = round(100 * returnee_adult_gvt_payroll / returnee_adults, 1),
         non_displaced_adult_perm_job = round(100 * non_displaced_adult_perm_job / non_displaced_adults, 1),
         non_displaced_adult_temp_job = round(100 * non_displaced_adult_temp_job / non_displaced_adults, 1),
         non_displaced_adult_daily_labour = round(100 * non_displaced_adult_daily_labour / non_displaced_adults, 1),
         non_displaced_adult_gvt_payroll = round(100 * non_displaced_adult_gvt_payroll / non_displaced_adults, 1),
         idp_adult_perm_job = round(100 * idp_adult_perm_job / idp_adults, 1),
         idp_adult_temp_job = round(100 * idp_adult_temp_job / idp_adults, 1),
         idp_adult_daily_labour = round(100 * idp_adult_daily_labour / idp_adults, 1),
         idp_adult_gvt_payroll = round(100 * idp_adult_gvt_payroll / idp_adults, 1),
         returnee_minor_perm_job = round(100 * returnee_minor_perm_job / returnee_minors, 1),
         returnee_minor_temp_job = round(100 * returnee_minor_temp_job / returnee_minors, 1),
         returnee_minor_daily_labour = round(100 * returnee_minor_daily_labour / returnee_minors, 1),
         idp_minor_perm_job = round(100 * idp_minor_perm_job / idp_minors, 1),
         idp_minor_temp_job = round(100 * idp_minor_temp_job / idp_minors, 1),
         idp_minor_daily_labour = round(100 * idp_minor_daily_labour / idp_minors, 1),
         non_displaced_minor_perm_job = round(100 * non_displaced_minor_perm_job / non_displaced_minors, 1),
         non_displaced_minor_temp_job = round(100 * non_displaced_minor_temp_job / non_displaced_minors, 1),
         non_displaced_minor_daily_labour = round(100 * non_displaced_minor_daily_labour / non_displaced_minors, 1)) %>%
  select(-returnee_adults, -idp_adults, -non_displaced_adults, -returnee_minors, -idp_minors, -non_displaced_minors,
         -total_assistance, -returnee_child_male, -returnee_enrolled_child_male, -returnee_attending_child_male,
         -returnee_youth_male, -returnee_enrolled_youth_male, -returnee_attending_youth_male,
         -returnee_child_female, -returnee_enrolled_child_female, -returnee_attending_child_female,
         -returnee_youth_female, -returnee_enrolled_youth_female, -returnee_attending_youth_female,
         -idp_child_male, -idp_enrolled_child_male, -idp_attending_child_male,
         -idp_youth_male, -idp_enrolled_youth_male, -idp_attending_youth_male,
         -idp_child_female, -idp_enrolled_child_female, -idp_attending_child_female,
         -idp_youth_female, -idp_enrolled_youth_female, -idp_attending_youth_female,
         -non_displaced_child_male, -non_displaced_enrolled_child_male, -non_displaced_attending_child_male,
         -non_displaced_youth_male, -non_displaced_enrolled_youth_male, -non_displaced_attending_youth_male,
         -non_displaced_child_female, -non_displaced_enrolled_child_female, -non_displaced_attending_child_female,
         -non_displaced_youth_female, -non_displaced_enrolled_youth_female, -non_displaced_attending_youth_female,
         -total_people, -total_working_male, -total_working_female)

write_csv(mantika_file, "output/mantika_data_merge.csv", na = "")
