explosive_action_3_pct = select_percents(presence_explosive_hazards_actions, 3, ., questions, choices, "percent"),
explosive_action_3_other_pct = 100 - explosive_action_1_pct - explosive_action_2_pct - explosive_action_3_pct,
no_explosive_awareness = percent_response(explosive_hazards_risk_awareness, ., "no"),
member_killed_injured = percent_response(explosive_hazards_injured, .,
"yes_adult_injured",
"yes_adult_killes",
"yes_children_injured",
"yes_children_killed"),
missing_members = percent_response(missing_family_members, ., "yes"),
movement_restrictions = percent_response(movement_restrictions, ., "yes"),
returnee_priority_need_1_name = select_percents(filter(., displacement_status == "returnee")[["priority_needs"]],
1,
filter(., displacement_status == "returnee"),
questions,
choices,
"label",
x_name = "priority_needs"),
returnee_priority_need_1_pct = select_percents(filter(., displacement_status == "returnee")[["priority_needs"]],
2,
filter(., displacement_status == "returnee"),
questions,
choices,
"percent",
x_name = "priority_needs"),
returnee_priority_need_2_name = select_percents(filter(., displacement_status == "returnee")[["priority_needs"]],
1,
filter(., displacement_status == "returnee"),
questions,
choices,
"label",
x_name = "priority_needs"),
returnee_priority_need_2_pct = select_percents(filter(., displacement_status == "returnee")[["priority_needs"]],
2,
filter(., displacement_status == "returnee"),
questions,
choices,
"percent",
x_name = "priority_needs"),
returnee_priority_need_3_name = select_percents(filter(., displacement_status == "returnee")[["priority_needs"]],
3,
filter(., displacement_status == "returnee"),
questions,
choices,
"label",
x_name = "priority_needs"),
returnee_priority_need_3_pct = select_percents(filter(., displacement_status == "returnee")[["priority_needs"]],
3,
filter(., displacement_status == "returnee"),
questions,
choices,
"percent",
x_name = "priority_needs"),
idp_priority_need_1_name = select_percents(filter(., displacement_status == "idp")[["priority_needs"]],
1,
filter(., displacement_status == "idp"),
questions,
choices,
"label",
x_name = "priority_needs"),
idp_priority_need_1_pct = select_percents(filter(., displacement_status == "idp")[["priority_needs"]],
2,
filter(., displacement_status == "idp"),
questions,
choices,
"percent",
x_name = "priority_needs"),
idp_priority_need_2_name = select_percents(filter(., displacement_status == "idp")[["priority_needs"]],
1,
filter(., displacement_status == "idp"),
questions,
choices,
"label",
x_name = "priority_needs"),
idp_priority_need_2_pct = select_percents(filter(., displacement_status == "idp")[["priority_needs"]],
2,
filter(., displacement_status == "idp"),
questions,
choices,
"percent",
x_name = "priority_needs"),
idp_priority_need_3_name = select_percents(filter(., displacement_status == "idp")[["priority_needs"]],
3,
filter(., displacement_status == "idp"),
questions,
choices,
"label",
x_name = "priority_needs"),
idp_priority_need_3_pct = select_percents(filter(., displacement_status == "idp")[["priority_needs"]],
3,
filter(., displacement_status == "idp"),
questions,
choices,
"percent",
x_name = "priority_needs"),
non_displaced_priority_need_1_name = select_percents(filter(., displacement_status == "non_displaced")[["priority_needs"]],
1,
filter(., displacement_status == "non_displaced"),
questions,
choices,
"label",
x_name = "priority_needs"),
non_displaced_priority_need_1_pct = select_percents(filter(., displacement_status == "non_displaced")[["priority_needs"]],
2,
filter(., displacement_status == "non_displaced"),
questions,
choices,
"percent",
x_name = "priority_needs"),
non_displaced_priority_need_2_name = select_percents(filter(., displacement_status == "non_displaced")[["priority_needs"]],
1,
filter(., displacement_status == "non_displaced"),
questions,
choices,
"label",
x_name = "priority_needs"),
non_displaced_priority_need_2_pct = select_percents(filter(., displacement_status == "non_displaced")[["priority_needs"]],
2,
filter(., displacement_status == "non_displaced"),
questions,
choices,
"percent",
x_name = "priority_needs"),
non_displaced_priority_need_3_name = select_percents(filter(., displacement_status == "non_displaced")[["priority_needs"]],
3,
filter(., displacement_status == "non_displaced"),
questions,
choices,
"label",
x_name = "priority_needs"),
non_displaced_priority_need_3_pct = select_percents(filter(., displacement_status == "non_displaced")[["priority_needs"]],
3,
filter(., displacement_status == "non_displaced"),
questions,
choices,
"percent",
x_name = "priority_needs"),
received_assistance = percent_response(received_humanitarian_assistance, ., "yes"),
rec_ass_type_1_name = select_percents(modality_assistance_received, 1, ., questions, choices, "label"),
rec_ass_type_1_pct = select_percents(modality_assistance_received, 1, ., questions, choices, "percent"),
rec_ass_type_2_name = select_percents(modality_assistance_received, 2, ., questions, choices, "label"),
rec_ass_type_2_pct = select_percents(modality_assistance_received, 2, ., questions, choices, "percent"),
rec_ass_type_3_name = select_percents(modality_assistance_received, 3, ., questions, choices, "label"),
rec_ass_type_3_pct = select_percents(modality_assistance_received, 3, ., questions, choices, "percent"),
rec_ass_type_4_name = select_percents(modality_assistance_received, 4, ., questions, choices, "label"),
rec_ass_type_4_pct = select_percents(modality_assistance_received, 4, ., questions, choices, "percent"),
rec_ass_type_5_name = select_percents(modality_assistance_received, 5, ., questions, choices, "label"),
rec_ass_type_5_pct = select_percents(modality_assistance_received, 5, ., questions, choices, "percent"),
assistance_satisfied = percent_response(humanitarian_assistance_satisfaction, ., "yes"),
returnee_ass_barrier_1_name = select_percents(filter(., displacement_status == "returnee")[["humanitarian_assistance_barriers"]],
1,
filter(., displacement_status == "returnee"),
questions,
choices,
"label",
x_name = "humanitarian_assistance_barriers"),
returnee_ass_barrier_1_pct = select_percents(filter(., displacement_status == "returnee")[["humanitarian_assistance_barriers"]],
1,
filter(., displacement_status == "returnee"),
questions,
choices,
"percent",
x_name = "humanitarian_assistance_barriers"),
returnee_ass_barrier_2_name = select_percents(filter(., displacement_status == "returnee")[["humanitarian_assistance_barriers"]],
2,
filter(., displacement_status == "returnee"),
questions,
choices,
"label",
x_name = "humanitarian_assistance_barriers"),
returnee_ass_barrier_2_pct = select_percents(filter(., displacement_status == "returnee")[["humanitarian_assistance_barriers"]],
2,
filter(., displacement_status == "returnee"),
questions,
choices,
"percent",
x_name = "humanitarian_assistance_barriers"),
returnee_ass_barrier_3_name = select_percents(filter(., displacement_status == "returnee")[["humanitarian_assistance_barriers"]],
3,
filter(., displacement_status == "returnee"),
questions,
choices,
"label",
x_name = "humanitarian_assistance_barriers"),
returnee_ass_barrier_3_pct = select_percents(filter(., displacement_status == "returnee")[["humanitarian_assistance_barriers"]],
3,
filter(., displacement_status == "returnee"),
questions,
choices,
"percent",
x_name = "humanitarian_assistance_barriers"),
idp_ass_barrier_1_name = select_percents(filter(., displacement_status == "idp")[["humanitarian_assistance_barriers"]],
1,
filter(., displacement_status == "idp"),
questions,
choices,
"label",
x_name = "humanitarian_assistance_barriers"),
idp_ass_barrier_1_pct = select_percents(filter(., displacement_status == "idp")[["humanitarian_assistance_barriers"]],
1,
filter(., displacement_status == "idp"),
questions,
choices,
"percent",
x_name = "humanitarian_assistance_barriers"),
idp_ass_barrier_2_name = select_percents(filter(., displacement_status == "idp")[["humanitarian_assistance_barriers"]],
2,
filter(., displacement_status == "idp"),
questions,
choices,
"label",
x_name = "humanitarian_assistance_barriers"),
idp_ass_barrier_2_pct = select_percents(filter(., displacement_status == "idp")[["humanitarian_assistance_barriers"]],
2,
filter(., displacement_status == "idp"),
questions,
choices,
"percent",
x_name = "humanitarian_assistance_barriers"),
idp_ass_barrier_3_name = select_percents(filter(., displacement_status == "idp")[["humanitarian_assistance_barriers"]],
3,
filter(., displacement_status == "idp"),
questions,
choices,
"label",
x_name = "humanitarian_assistance_barriers"),
idp_ass_barrier_3_pct = select_percents(filter(., displacement_status == "idp")[["humanitarian_assistance_barriers"]],
3,
filter(., displacement_status == "idp"),
questions,
choices,
"percent",
x_name = "humanitarian_assistance_barriers"),
non_displaced_ass_barrier_1_name = select_percents(filter(., displacement_status == "non_displaced")[["humanitarian_assistance_barriers"]],
1,
filter(., displacement_status == "non_displaced"),
questions,
choices,
"label",
x_name = "humanitarian_assistance_barriers"),
non_displaced_ass_barrier_1_pct = select_percents(filter(., displacement_status == "non_displaced")[["humanitarian_assistance_barriers"]],
1,
filter(., displacement_status == "non_displaced"),
questions,
choices,
"percent",
x_name = "humanitarian_assistance_barriers"),
non_displaced_ass_barrier_2_name = select_percents(filter(., displacement_status == "non_displaced")[["humanitarian_assistance_barriers"]],
2,
filter(., displacement_status == "non_displaced"),
questions,
choices,
"label",
x_name = "humanitarian_assistance_barriers"),
non_displaced_ass_barrier_2_pct = select_percents(filter(., displacement_status == "non_displaced")[["humanitarian_assistance_barriers"]],
2,
filter(., displacement_status == "non_displaced"),
questions,
choices,
"percent",
x_name = "humanitarian_assistance_barriers"),
non_displaced_ass_barrier_3_name = select_percents(filter(., displacement_status == "non_displaced")[["humanitarian_assistance_barriers"]],
3,
filter(., displacement_status == "non_displaced"),
questions,
choices,
"label",
x_name = "humanitarian_assistance_barriers"),
non_displaced_ass_barrier_3_pct = select_percents(filter(., displacement_status == "non_displaced")[["humanitarian_assistance_barriers"]],
3,
filter(., displacement_status == "non_displaced"),
questions,
choices,
"percent",
x_name = "humanitarian_assistance_barriers"),
returnee_prefer_ass_1_name = select_percents(filter(., displacement_status == "returnee")[["preferred_assistance_modality"]],
1,
filter(., displacement_status == "returnee"),
questions,
choices,
"label",
x_name = "preferred_assistance_modality"),
returnee_prefer_ass_1_pct = select_percents(filter(., displacement_status == "returnee")[["preferred_assistance_modality"]],
1,
filter(., displacement_status == "returnee"),
questions,
choices,
"percent",
x_name = "preferred_assistance_modality"),
returnee_prefer_ass_2_name = select_percents(filter(., displacement_status == "returnee")[["preferred_assistance_modality"]],
2,
filter(., displacement_status == "returnee"),
questions,
choices,
"label",
x_name = "preferred_assistance_modality"),
returnee_prefer_ass_2_pct = select_percents(filter(., displacement_status == "returnee")[["preferred_assistance_modality"]],
2,
filter(., displacement_status == "returnee"),
questions,
choices,
"percent",
x_name = "preferred_assistance_modality"),
returnee_prefer_ass_3_name = select_percents(filter(., displacement_status == "returnee")[["preferred_assistance_modality"]],
3,
filter(., displacement_status == "returnee"),
questions,
choices,
"label",
x_name = "preferred_assistance_modality"),
returnee_prefer_ass_3_pct = select_percents(filter(., displacement_status == "returnee")[["preferred_assistance_modality"]],
3,
filter(., displacement_status == "returnee"),
questions,
choices,
"percent",
x_name = "preferred_assistance_modality"),
idp_prefer_ass_1_name = select_percents(filter(., displacement_status == "idp")[["preferred_assistance_modality"]],
1,
filter(., displacement_status == "idp"),
questions,
choices,
"label",
x_name = "preferred_assistance_modality"),
idp_prefer_ass_1_pct = select_percents(filter(., displacement_status == "idp")[["preferred_assistance_modality"]],
1,
filter(., displacement_status == "idp"),
questions,
choices,
"percent",
x_name = "preferred_assistance_modality"),
idp_prefer_ass_2_name = select_percents(filter(., displacement_status == "idp")[["preferred_assistance_modality"]],
2,
filter(., displacement_status == "idp"),
questions,
choices,
"label",
x_name = "preferred_assistance_modality"),
idp_prefer_ass_2_pct = select_percents(filter(., displacement_status == "idp")[["preferred_assistance_modality"]],
2,
filter(., displacement_status == "idp"),
questions,
choices,
"percent",
x_name = "preferred_assistance_modality"),
idp_prefer_ass_3_name = select_percents(filter(., displacement_status == "idp")[["preferred_assistance_modality"]],
3,
filter(., displacement_status == "idp"),
questions,
choices,
"label",
x_name = "preferred_assistance_modality"),
idp_prefer_ass_3_pct = select_percents(filter(., displacement_status == "idp")[["preferred_assistance_modality"]],
3,
filter(., displacement_status == "idp"),
questions,
choices,
"percent",
x_name = "preferred_assistance_modality"),
non_displaced_prefer_ass_1_name = select_percents(filter(., displacement_status == "non_displaced")[["preferred_assistance_modality"]],
1,
filter(., displacement_status == "non_displaced"),
questions,
choices,
"label",
x_name = "preferred_assistance_modality"),
non_displaced_prefer_ass_1_pct = select_percents(filter(., displacement_status == "non_displaced")[["preferred_assistance_modality"]],
1,
filter(., displacement_status == "non_displaced"),
questions,
choices,
"percent",
x_name = "preferred_assistance_modality"),
non_displaced_prefer_ass_2_name = select_percents(filter(., displacement_status == "non_displaced")[["preferred_assistance_modality"]],
2,
filter(., displacement_status == "non_displaced"),
questions,
choices,
"label",
x_name = "preferred_assistance_modality"),
non_displaced_prefer_ass_2_pct = select_percents(filter(., displacement_status == "non_displaced")[["preferred_assistance_modality"]],
2,
filter(., displacement_status == "non_displaced"),
questions,
choices,
"percent",
x_name = "preferred_assistance_modality"),
non_displaced_prefer_ass_3_name = select_percents(filter(., displacement_status == "non_displaced")[["preferred_assistance_modality"]],
3,
filter(., displacement_status == "non_displaced"),
questions,
choices,
"label",
x_name = "preferred_assistance_modality"),
non_displaced_prefer_ass_3_pct = select_percents(filter(., displacement_status == "non_displaced")[["preferred_assistance_modality"]],
3,
filter(., displacement_status == "non_displaced"),
questions,
choices,
"percent",
x_name = "preferred_assistance_modality")) %>%
mutate(returnee_adult_perm_job = round(100 * returnee_adult_perm_job / returnee_adults, 1),
returnee_adult_temp_job = round(100 * returnee_adult_temp_job / returnee_adults, 1),
returnee_adult_daily_labour = round(100 * returnee_adult_daily_labour / returnee_adults, 1),
returnee_adult_gvt_payroll = round(100 * returnee_adult_gvt_payroll / returnee_adults, 1),
non_displaced_adult_perm_job = round(100 * non_displaced_adult_perm_job / non_displaced_adults, 1),
non_displaced_adult_temp_job = round(100 * non_displaced_adult_temp_job / non_displaced_adults, 1),
non_displaced_adult_daily_labour = round(100 * non_displaced_adult_daily_labour / non_displaced_adults, 1),
non_displaced_adult_gvt_payroll = round(100 * non_displaced_adult_gvt_payroll / non_displaced_adults, 1),
idp_adult_perm_job = round(100 * idp_adult_perm_job / idp_adults, 1),
idp_adult_temp_job = round(100 * idp_adult_temp_job / idp_adults, 1),
idp_adult_daily_labour = round(100 * idp_adult_daily_labour / idp_adults, 1),
idp_adult_gvt_payroll = round(100 * idp_adult_gvt_payroll / idp_adults, 1),
returnee_minor_perm_job = round(100 * returnee_minor_perm_job / returnee_minors, 1),
returnee_minor_temp_job = round(100 * returnee_minor_temp_job / returnee_minors, 1),
returnee_minor_daily_labour = round(100 * returnee_minor_daily_labour / returnee_minors, 1),
idp_minor_perm_job = round(100 * idp_minor_perm_job / idp_minors, 1),
idp_minor_temp_job = round(100 * idp_minor_temp_job / idp_minors, 1),
idp_minor_daily_labour = round(100 * idp_minor_daily_labour / idp_minors, 1),
non_displaced_minor_perm_job = round(100 * non_displaced_minor_perm_job / non_displaced_minors, 1),
non_displaced_minor_temp_job = round(100 * non_displaced_minor_temp_job / non_displaced_minors, 1),
non_displaced_minor_daily_labour = round(100 * non_displaced_minor_daily_labour / non_displaced_minors, 1)) %>%
select(-returnee_adults, -idp_adults, -non_displaced_adults, -returnee_minors, -idp_minors, -non_displaced_minors,
-total_assistance, -returnee_child_male, -returnee_enrolled_child_male, -returnee_attending_child_male,
-returnee_youth_male, -returnee_enrolled_youth_male, -returnee_attending_youth_male,
-returnee_child_female, -returnee_enrolled_child_female, -returnee_attending_child_female,
-returnee_youth_female, -returnee_enrolled_youth_female, -returnee_attending_youth_female,
-idp_child_male, -idp_enrolled_child_male, -idp_attending_child_male,
-idp_youth_male, -idp_enrolled_youth_male, -idp_attending_youth_male,
-idp_child_female, -idp_enrolled_child_female, -idp_attending_child_female,
-idp_youth_female, -idp_enrolled_youth_female, -idp_attending_youth_female,
-non_displaced_child_male, -non_displaced_enrolled_child_male, -non_displaced_attending_child_male,
-non_displaced_youth_male, -non_displaced_enrolled_youth_male, -non_displaced_attending_youth_male,
-non_displaced_child_female, -non_displaced_enrolled_child_female, -non_displaced_attending_child_female,
-non_displaced_youth_female, -non_displaced_enrolled_youth_female, -non_displaced_attending_youth_female,
-total_people, -total_working_male, -total_working_female)
mantika_shelter_damage <- dm_data %>%
group_by(mantika_label) %>%
summarize(no_shelter_damage = percent_response(shelter_condition, ., "no_negligible_damage", group = !!get_group(.)),
light_shelter_damage = percent_response(shelter_condition, ., "light_damage", group = !!get_group(.)),
medium_shelter_damage = percent_response(shelter_condition, ., "medium_damage", group = !!get_group(.)),
heavy_shelter_damage = percent_response(shelter_condition, ., "heavy_damage", group = !!get_group(.)),
shelter_destroyed = percent_response(shelter_condition, ., "shelter_destroyed", group = !!get_group(.))) %>%
big_spread(mantika_label, c(no_shelter_damage, light_shelter_damage, medium_shelter_damage, heavy_shelter_damage, shelter_destroyed)) %>%
rename_all(tolower) %>%
rename_all(str_replace_all, " ", "_")
mantika_public_network <- dm_data %>%
group_by(mantika_label) %>%
summarize(power_cuts = weighted_median(power_cuts, ., group = !!get_group(.))) %>%
spread(mantika_label, power_cuts) %>%
rename_all(tolower) %>%
rename_all(str_replace_all, " ", "_") %>%
rename_all(paste0, "_power_cuts")
mantika_water_distance <- dm_data %>%
group_by(mantika_label) %>%
summarize(water_dist_100m = percent_response(distance_drinkingwater, ., "upto_100m", group = !!get_group(.)),
water_dist_200m = percent_response(distance_drinkingwater, ., "between_101_200m", group = !!get_group(.)),
water_dist_300m = percent_response(distance_drinkingwater, ., "between_201_300m", group = !!get_group(.)),
water_dist_400m = percent_response(distance_drinkingwater, ., "between_301_400m", group = !!get_group(.)),
water_dist_500m = percent_response(distance_drinkingwater, ., "between_401_500m", group = !!get_group(.)),
water_dist_more_500m = percent_response(distance_drinkingwater, ., "more_500m", group = !!get_group(.))) %>%
big_spread(mantika_label, c(water_dist_100m, water_dist_200m, water_dist_300m, water_dist_400m, water_dist_500m, water_dist_more_500m))  %>%
rename_all(tolower) %>%
rename_all(str_replace_all, " ", "_")
mantika_explosives_awareness <- dm_data %>%
group_by(mantika_label) %>%
summarize(aware_explosives = percent_response(presence_explosive_hazards, ., "yes", group = !!get_group(.))) %>%
spread(mantika_label, aware_explosives) %>%
rename_all(tolower) %>%
rename_all(str_replace_all, " ", "_") %>%
rename_all(paste0, "_aware_explosives")
mantika_water_insufficient <- dm_data %>%
group_by(mantika_label) %>%
summarize(sufficient_water = percent_response(unsufficient_quantity_water, ., "yes", group = !!get_group(.))) %>%
arrange(desc(sufficient_water)) %>%
slice(1:5) %>%
t
mantika_water_insufficient_row <- tibble(
insufficient_water_mantika_1_name = mantika_water_insufficient[1,1],
insufficient_water_mantika_1_pct = mantika_water_insufficient[2,1],
insufficient_water_mantika_2_name = mantika_water_insufficient[1,2],
insufficient_water_mantika_2_pct = mantika_water_insufficient[2,2],
insufficient_water_mantika_3_name = mantika_water_insufficient[1,3],
insufficient_water_mantika_3_pct = mantika_water_insufficient[2,3],
insufficient_water_mantika_4_name = mantika_water_insufficient[1,4],
insufficient_water_mantika_4_pct = mantika_water_insufficient[2,4],
insufficient_water_mantika_5_name = mantika_water_insufficient[1,5],
insufficient_water_mantika_5_pct = mantika_water_insufficient[2,5]
)
mantika_movement_restrictions <- dm_data %>%
group_by(mantika_label) %>%
summarize(movement_restrictions = percent_response(movement_restrictions, ., "yes", group = !!get_group(.))) %>%
arrange(desc(movement_restrictions)) %>%
slice(1:3) %>%
t
mantika_movement_restrictions_row <- tibble(
movement_restriction_mantika_1_name = mantika_movement_restrictions[1,1],
movement_restriction_mantika_1_pct = mantika_movement_restrictions[2,1],
movement_restriction_mantika_2_name = mantika_movement_restrictions[1,2],
movement_restriction_mantika_2_pct = mantika_movement_restrictions[2,2],
movement_restriction_mantika_3_name = mantika_movement_restrictions[1,3],
movement_restriction_mantika_3_pct = mantika_movement_restrictions[2,3]
)
dm_file <- bind_cols(dm_file,
mantika_shelter_damage,
mantika_public_network,
mantika_water_distance,
mantika_explosives_awareness,
mantika_water_insufficient_row,
mantika_movement_restrictions_row)
getwd()
write_csv(dm_file, "output/sector_data_merge.csv")
source('C:/Users/REACH/Dropbox/2. Research projects/3. Humanitarian Pillar/1. MSNA/3. MSNA 2019/1. Libya MSNA/7. Analysis/lby_msna2019/code/mantika_data_merge.R')
